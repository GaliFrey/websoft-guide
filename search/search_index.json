{"config":{"lang":["ru"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"WebSoft Guide","text":"<p>\u041c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u044b \u043f\u043e \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u0435 WebSoft.</p> <p>\u0414\u043b\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u043f\u043e \u0440\u0430\u0437\u0434\u0435\u043b\u0430\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u044e \u0432 \u0448\u0430\u043f\u043a\u0435 \u0441\u0430\u0439\u0442\u0430</p>"},{"location":"contacts/","title":"\u041a\u043e\u043d\u0442\u0430\u043a\u0442\u044b","text":""},{"location":"contacts/#_1","title":"\u0424\u0418\u041e","text":"<p>\u0417\u0430\u0433\u043e\u0441\u043a\u0438\u043d \u0412\u043b\u0430\u0434\u0438\u0441\u043b\u0430\u0432 \u0410\u043d\u0434\u0440\u0435\u0435\u0432\u0438\u0447</p>"},{"location":"contacts/#_2","title":"\u041f\u043e\u0447\u0442\u0430","text":"<p>zagoskin.vladislav.a@yandex.ru</p>"},{"location":"contacts/#_3","title":"\u0420\u0435\u0437\u044e\u043c\u0435","text":"<p>\u0420\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a WebTutor/E-staff</p>"},{"location":"materials/mssql-xml-tutorial/","title":"\u041f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u043f\u043e \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u043f\u043e\u043b\u044f\u043c\u0438 XML \u0432 MS SQL","text":"<p>\u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 XML \u043f\u043e\u043b\u044f\u043c\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043c\u0435\u0442\u043e\u0434\u044b SQL Server.</p> <p>\u0412\u0441\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u043e\u043f\u0438\u0441\u0430\u043d\u044b \u0432 \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u043c \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u0435 Microsoft.</p> <p>\u0422\u0430\u043a \u0436\u0435 \u0435\u0441\u0442\u044c \u0445\u043e\u0440\u043e\u0448\u0435\u0435 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043d\u0430 \u0441\u0430\u0439\u0442\u0435 sql-tutorial.ru.</p> <p>\u0412\u0410\u0416\u041d\u041e!</p> <p>\u0412 \u0441\u0442\u0430\u0442\u044c\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u041e\u0422\u0412\u042f\u0417\u0410\u041d\u042b \u043e\u0442 XML \u0441\u0445\u0435\u043c. \u041f\u0440\u0438 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 XML \u0441\u0445\u0435\u043c\u0430\u0445 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u044b.</p> <p>\u0427\u0442\u043e\u0431\u044b \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0443 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043a XML \u0441\u0445\u0435\u043c\u0435, \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0437\u0430\u043f\u0440\u043e\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u043f\u0440\u0438\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441\u0445\u0435\u043c\u044b</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  *\nfrom    sys.xml_schema_collections XSC \n        join sys.xml_schema_namespaces XSN on (XSC.xml_collection_id = XSN.xml_collection_id)\nwhere    XSC.name = 'position';\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml","title":"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u043c\u0435\u0442\u043e\u0434\u044b \u0434\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 XML","text":"<p>\u041d\u0443\u043c\u0435\u0440\u0430\u0446\u0438\u044f \u0443\u0437\u043b\u043e\u0432 \u0432 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0445 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441 1</p> <p>\u0412 \u043c\u0435\u0442\u043e\u0434\u0430\u0445 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u0443\u0437\u043b\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u044f\u0437\u044b\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 <code>XPath</code> \u0438\u043b\u0438 <code>XQuery</code>.</p> <p>\u0414\u043b\u044f \u0440\u0430\u0431\u043e\u0442\u044b \u0441 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u043c \u0432 T-SQL \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u043c\u0435\u0442\u043e\u0434\u044b:</p> <ul> <li>query</li> <li>value</li> <li>exist</li> <li>nodes</li> <li>modify</li> </ul>"},{"location":"materials/mssql-xml-tutorial/#query","title":"\u041c\u0435\u0442\u043e\u0434 query","text":"<p>\u041c\u0435\u0442\u043e\u0434 <code>query</code> \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0438\u0437\u0432\u043b\u0435\u0447\u0435\u043d\u0438\u044f XML \u0443\u0437\u043b\u043e\u0432. \u041c\u0435\u0442\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u043d\u0435\u0442\u0438\u043f\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e XML.</p> <pre><code>data.query('XPath')\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#value","title":"\u041c\u0435\u0442\u043e\u0434 value","text":"<p>\u041c\u0435\u0442\u043e\u0434 <code>value</code> \u0438\u0437\u0432\u043b\u0435\u043a\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0443\u0437\u043b\u0430 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435\u043c \u0442\u0438\u043f\u0430 \u0434\u0430\u043d\u043d\u044b\u0445. \u0414\u0430\u043d\u043d\u044b\u0439 \u043c\u0435\u0442\u043e\u0434 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043a\u0430\u043b\u044f\u0440\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435. \u041f\u0440\u0438 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0443\u0436\u043d\u044b\u0439 \u0442\u0438\u043f \u2014 \u0441\u0435\u0440\u0432\u0435\u0440 \u0432\u044b\u043a\u0438\u0434\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443. \u041d\u0443\u0436\u043d\u043e \u044f\u0432\u043d\u043e \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043d\u043e\u043c\u0435\u0440 \u0443\u0437\u043b\u0430, \u0437\u0430 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430 \u0442\u043e\u0447\u043a\u0430 <code>'.'</code> - \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435.</p> <pre><code>data.value('XPath', 'DataType')\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#exist","title":"\u041c\u0435\u0442\u043e\u0434 exist","text":"<p>\u041c\u0435\u0442\u043e\u0434 <code>exist</code> \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f <code>XPath</code>. \u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0438\u043f\u0430 <code>bit</code>, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043e\u0434\u043d\u043e \u0438\u0437 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439:</p> <ul> <li>1 - \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0435\u0435 <code>True</code>, \u0435\u0441\u043b\u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 \u044f\u0437\u044b\u043a\u0435 <code>XQuery</code> \u043f\u0440\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043d\u0435\u043f\u0443\u0441\u0442\u043e\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442, \u0442\u043e \u0435\u0441\u0442\u044c \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a \u043c\u0438\u043d\u0438\u043c\u0443\u043c \u043e\u0434\u0438\u043d \u0443\u0437\u0435\u043b <code>XML</code>.</li> <li>0 - \u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0435\u0435 <code>False</code> \u043f\u0440\u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u0438\u0438 \u043f\u0443\u0441\u0442\u043e\u0433\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430.</li> <li>NULL - \u0435\u0441\u043b\u0438 \u044d\u043a\u0437\u0435\u043c\u043f\u043b\u044f\u0440 \u0442\u0438\u043f\u0430 <code>xml</code>, \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u0431\u044b\u043b \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d \u0437\u0430\u043f\u0440\u043e\u0441, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>NULL</code>.</li> </ul> <pre><code>data.exist('XPath')\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#nodes","title":"\u041c\u0435\u0442\u043e\u0434 nodes","text":"<p>\u041c\u0435\u0442\u043e\u0434 <code>nodes</code> \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u0442 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435\u043c <code>XPath</code>, \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u044f \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u0438\u0437 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 XML \u0443\u0437\u043b\u043e\u0432.</p> <pre><code>data.nodes('XPath') as Table(Column)\n</code></pre> <p>\u041f\u0440\u0438\u043c\u0435\u0440. \u0423 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442 \u0441\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0439 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u043e\u0439:</p> <pre><code>&lt;root&gt;\n    &lt;label&gt;\u041c\u0430\u043a\u0430\u0440\u043e\u043d\u044b&lt;/label&gt;\n    &lt;value&gt;200 \u0433\u0440&lt;/value&gt;\n    &lt;label&gt;\u0424\u0440\u0443\u043a\u0442\u044b&lt;/label&gt;\n    &lt;value&gt;400 \u0433\u0440&lt;/value&gt;\n    &lt;label&gt;\u041e\u0440\u0435\u0445\u0438&lt;/label&gt;\n    &lt;value&gt;100 \u0433\u0440&lt;/value&gt;\n&lt;/root&gt;\n</code></pre> <p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u0435\u0442\u043e\u0434\u0430 <code>nodes('root/value') AS Table1(field)</code> \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u0442 \u043a \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u044b <code>Table1</code> \u0438 \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u043c <code>field</code>, \u0433\u0434\u0435 \u043a\u0430\u0436\u0434\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430 \u2014 \u044d\u0442\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0439 \u0443\u0437\u0435\u043b \u043f\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044e <code>Xpath</code></p> <p></p> <p>\u041c\u0435\u0442\u043e\u0434 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u0438 \u0441 \u0434\u0440\u0443\u0433\u0438\u043c\u0438 \u043c\u0435\u0442\u043e\u0434\u0430\u043c\u0438 \u0438\u043b\u0438 \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c <code>CROSS APPLY</code>. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0441 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u043e\u043c <code>CROSS APPLY</code> \u0441\u043e\u0437\u0434\u0430\u0441\u0442 \u044d\u0444\u0444\u0435\u043a\u0442 <code>LEFT JOIN</code> \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0441 \u0442\u0430\u0431\u043b\u0438\u0446\u0435\u0439, \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0439 <code>nodes</code>.</p>"},{"location":"materials/mssql-xml-tutorial/#modify","title":"\u041c\u0435\u0442\u043e\u0434 modify","text":"<p>\u041c\u0435\u0442\u043e\u0434 <code>modify</code> \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0438 <code>UPDATE</code> \u0438 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430 \u043e\u0434\u0438\u043d \u0440\u0430\u0437 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.</p> <p>\u0414\u043b\u044f \u043c\u0435\u0442\u043e\u0434\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 3 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u0430:</p> <ul> <li>insert</li> <li>delete</li> <li>replace value of</li> </ul> <p>\u041a\u0430\u0436\u0434\u044b\u0439 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \u0441\u0430\u043c \u0437\u0430 \u0441\u0435\u0431\u044f: \u0432\u0441\u0442\u0430\u0432\u043a\u0430, \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435, \u0437\u0430\u043c\u0435\u043d\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.</p>"},{"location":"materials/mssql-xml-tutorial/#insert","title":"insert","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>insert</code> \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c XML \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b. \u0418\u043c\u0435\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440\u044b \u0434\u043b\u044f \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f \u043c\u0435\u0441\u0442\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f:</p> <pre><code>data.modify('insert (&lt;field&gt;...&lt;/field&gt;) into (XPath)')\n</code></pre> <ul> <li><code>{ as first || as last } into</code> - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0443\u0437\u0435\u043b \u043a\u0430\u043a \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435. <code>as last</code> \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u043f\u043e\u0442\u043e\u043c\u043a\u043e\u043c, \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435\u043c \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e. <code>as first into</code> \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0435\u0440\u0432\u044b\u043c \u043f\u043e\u0442\u043e\u043c\u043a\u043e\u043c.</li> <li><code>after</code> - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u0441\u043b\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430.</li> <li><code>before</code> - \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u0434 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u043c \u0443\u0437\u043b\u043e\u043c.</li> </ul>"},{"location":"materials/mssql-xml-tutorial/#delete","title":"delete","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>delete</code> \u0443\u0434\u0430\u043b\u044f\u0435\u0442 \u0447\u0430\u0441\u0442\u044c XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u043f\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044e <code>XPath</code>.</p> <pre><code>data.modify('delete (XPath)')\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#replace-value-of","title":"replace value of","text":"<p>\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>replace value of</code> \u0438\u0437\u043c\u0435\u043d\u044f\u0435\u0442 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u0443\u0437\u043b\u0430.</p> <pre><code>data.modify('replace value of (XPath) with (value)')\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#sql","title":"\u0421\u0431\u043e\u0440\u043d\u0438\u043a \u0437\u0430\u0434\u0430\u0447 SQL","text":""},{"location":"materials/mssql-xml-tutorial/#xml_1","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u0435\u0440\u0432\u044b\u0439 XML \u0443\u0437\u0435\u043b \u043f\u043e \u0435\u0433\u043e \u0438\u043c\u0435\u043d\u0438","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u043f\u0435\u0440\u0432\u044b\u0439 \u0443\u0437\u0435\u043b \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>lastname</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(/collaborator/lastname)[1]')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n</code></pre> <p>\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u043f\u0435\u0440\u0432\u044b\u0439 \u0443\u0437\u0435\u043b <code>lastname</code> \u0441\u043e \u0432\u0441\u0435\u043c \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c. \u041d\u043e\u043c\u0435\u0440 \u0443\u0437\u043b\u0430 \u0434\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u0434\u0430\u0435\u0442\u0441\u044f <code>[1]</code></p>"},{"location":"materials/mssql-xml-tutorial/#xml_2","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0432\u0441\u0435 XML \u0443\u0437\u043b\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>name</code>. \u0412 \u043d\u0430\u0448\u0435\u043c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435 \u0432\u0441\u0435\u0433\u043e \u0442\u0440\u0438 \u0443\u0437\u043b\u0430 \u0441 \u0442\u0430\u043a\u0438\u043c \u0438\u043c\u0435\u043d\u0435\u043c \u0438 \u0432\u0441\u0435 \u043e\u043d\u0438 \u0432\u043b\u043e\u0436\u0435\u043d\u044b \u0432 \u0440\u0430\u0437\u043d\u044b\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b <code>custom_elem</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(/collaborator/custom_elems/custom_elem/name)')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;name&gt;fld_city&lt;/name&gt;\n&lt;name&gt;fld_sex&lt;/name&gt;\n&lt;name&gt;fld_birth_date&lt;/name&gt;\n</code></pre> <p>\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u0432\u0441\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0435 \u0443\u0437\u043b\u044b \u043f\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u043c\u0443 \u043f\u0443\u0442\u0438, \u0442\u0430\u043a \u043a\u0430\u043a \u043c\u044b \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043b\u0438 \u043d\u043e\u043c\u0435\u0440 \u0443\u0437\u043b\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430\u043c \u043d\u0443\u0436\u0435\u043d</p>"},{"location":"materials/mssql-xml-tutorial/#_1","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0443\u0437\u0435\u043b \u0441\u043e \u0432\u0441\u0435\u043c \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u043b\u044b \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439 \u0441 \u0435\u0433\u043e \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u0435\u043c. \u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u0443\u0437\u043b\u0430\u0445 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>custom_elem</code>, \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0443\u0437\u0435\u043b \u0434\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0445 <code>custom_elems</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(/collaborator/custom_elems)')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;custom_elems&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_city&lt;/name&gt;\n        &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_sex&lt;/name&gt;\n        &lt;value&gt;\u041c&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_birth_date&lt;/name&gt;\n        &lt;value&gt;1988-06-02T00:00:00+00:00&lt;/value&gt;\n    &lt;/custom_elem&gt;\n&lt;/custom_elems&gt;\n</code></pre> <p>\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u0443\u0437\u0435\u043b <code>custom_elems</code> \u0441\u043e \u0432\u0441\u0435\u043c\u0438 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u043c\u0438 \u0443\u0437\u043b\u0430\u043c\u0438</p>"},{"location":"materials/mssql-xml-tutorial/#xml_3","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044f","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>name</code> \u0438\u0437 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u0443\u0437\u043b\u0430 <code>custom_elem</code>. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u044f\u0432\u043d\u043e\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(collaborator/custom_elems/custom_elem[2]/name)')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;name&gt;fld_sex&lt;/name&gt;\n</code></pre> <p>\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 <code>name</code> \u0438\u0437 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u043f\u043e \u0441\u0447\u0435\u0442\u0443 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 <code>custom_elem</code></p>"},{"location":"materials/mssql-xml-tutorial/#xml_4","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0435\u0433\u043e \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>custom_elem</code> \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(/collaborator/custom_elems/custom_elem[name=\"fld_city\"])[1]')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;custom_elem&gt;\n    &lt;name&gt;fld_city&lt;/name&gt;\n    &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n&lt;/custom_elem&gt;\n</code></pre> <p>\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>...custom_elem[name=\"fld_city\"]...</code> \u0438\u0449\u0435\u0442 \u0443\u0437\u0435\u043b <code>custom_elem</code> \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code> \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 \u0443\u0437\u0435\u043b <code>custom_elem</code></p>"},{"location":"materials/mssql-xml-tutorial/#xml-xml","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0441\u043e\u0441\u0435\u0434\u043d\u0435\u0433\u043e XML \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u044d\u043b\u0435\u043c\u0435\u043d\u0442 <code>value</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0435 <code>custom_elem</code>, \u0433\u0434\u0435 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 <code>name</code> \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>fld_city</code>.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select  data.query('(/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value)[1]')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> MSSQLXML <p></p> <pre><code>&lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#xml_5","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432 \u0441 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 (\u0418\u0414, \u0444\u0430\u043c\u0438\u043b\u0438\u044e, \u0434\u0430\u0442\u0443 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438 \u0444\u043b\u0430\u0433 \u0443\u0432\u043e\u043b\u0435\u043d \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a \u0438\u043b\u0438 \u043d\u0435\u0442)</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/id)[1]', 'bigint') as id\n        ,data.value('(/collaborator/lastname)[1]', 'varchar(40)') as lastname\n        ,data.value('(/collaborator/birth_date)[1]', 'date') as birth_date\n        ,data.value('(/collaborator/is_dismiss)[1]', 'bit') as is_dismiss\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u0415\u0441\u043b\u0438 \u043f\u043e\u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u043b\u0435 <code>lastname</code> \u043a \u0434\u0430\u0442\u0435, \u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u043e\u0448\u0438\u0431\u043a\u0443</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_6","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0435\u0434\u043d\u0435\u0433\u043e XML \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439 \u0441 \u0438\u043c\u0435\u043d\u0430\u043c\u0438 <code>fld_city</code>, <code>fld_sex</code> \u0438 <code>fld_birth_date</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value)[1]', 'varchar(50)') as fld_city\n        ,data.value('(/collaborator/custom_elems/custom_elem[name=\"fld_sex\"])[1]/value[1]', 'varchar') as fld_sex\n        ,data.value('(/collaborator/custom_elems/custom_elem[name=\"fld_birth_date\"]/value)[1]', 'datetime') as fld_birth_date\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>...custom_elem[name=\"fld_city\"]/value...</code> \u0438\u0449\u0435\u0442 \u0443\u0437\u0435\u043b \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>custom_elem</code>, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043b\u043e\u0436\u0435\u043d \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code>. \u0414\u0430\u043b\u044c\u0448\u0435 \u043c\u044b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c <code>/value</code> - \u0442\u043e \u0435\u0441\u0442\u044c \u0432 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u043c \u0443\u0437\u043b\u0435 <code>custom_elem</code> \u0441 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u043c \u0443\u0437\u043b\u043e\u043c <code>&lt;name&gt;fld_city&lt;/name&gt;</code> \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u043c\u0441\u044f \u043a \u0443\u0437\u043b\u0443 <code>&lt;value&gt;...&lt;/value&gt;</code> \u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435. \u041d\u0430 \u0441\u0430\u043c\u043e\u043c \u0434\u0435\u043b\u0435 <code>name</code> \u0438 <code>value</code> \u044d\u0442\u043e \u0432\u0441\u0435\u0433\u043e \u043b\u0438\u0448\u044c \u0438\u043c\u0435\u043d\u0430 \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u0443\u0437\u043b\u043e\u0432</p>"},{"location":"materials/mssql-xml-tutorial/#xml_7","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0441\u043e\u0441\u0435\u0434\u043d\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 XML","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <code>history_states</code> \u043f\u0435\u0440\u0432\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 <code>history_state</code>, \u043f\u043e\u043b\u0435 <code>state_id</code> \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>vacation</code>, \u0438 \u0432\u044b\u0432\u0435\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432 <code>start_date</code> \u0438 <code>finish_date</code> \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0434\u0430\u0442\u044b.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441: <pre><code>select   data.value('(/collaborator/history_states/history_state[state_id=\"vacation\"]/start_date)[1]', 'date') as start_date\n        ,data.value('(/collaborator/history_states/history_state[state_id=\"vacation\"]/finish_date)[1]', 'date') as finish_date\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre></p> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_8","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0439 \u0443\u0437\u0435\u043b XML","text":"<p>\u041a\u043e\u0433\u0434\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0443\u0437\u043b\u043e\u0432 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u043e, \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0443\u0437\u0435\u043b \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>last()</code>, \u043f\u0440\u0435\u0434\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 <code>last()-1</code> \u0438 \u0442.\u0434.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/custom_elems/custom_elem[last()]/value)[1]', 'varchar(50)') as fld_birth_date\n        ,data.value('(/collaborator/custom_elems/custom_elem[last()-1]/value)[1]', 'varchar(50)') as fld_sex\n        ,data.value('(/collaborator/custom_elems/custom_elem[last()-2]/value)[1]', 'varchar(50)') as fld_city\n        ,data.value('(/collaborator/custom_elems/custom_elem[last()-3]/value)[1]', 'varchar(50)') as not_fount\n        ,data.value('(/collaborator/custom_elems/custom_elem[last()-4]/value)[1]', 'varchar(50)') as not_fount\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0415\u0441\u043b\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 <code>NULL</code></p>"},{"location":"materials/mssql-xml-tutorial/#xml_9","title":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 XML \u0443\u0437\u043b\u043e\u0432","text":"<p>\u0423 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0435\u0441\u0442\u044c 2 \u043e\u0442\u043f\u0443\u0441\u043a\u0430. \u0412 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f\u0445 \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043d\u0435\u0439 \u043e\u0442\u043f\u0443\u0441\u043a\u0430. \u041d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0442\u043f\u0443\u0441\u043a\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0443\u043c\u043c\u0443 \u0434\u043d\u0435\u0439. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c 2 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>count()</code> \u0438 <code>sum()</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('count(/collaborator/history_states/history_state/comment)','int') as count_days\n        ,data.value('sum(/collaborator/history_states/history_state/comment)','int') as sum_days\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0412\u0410\u0416\u041d\u041e</p> <p>\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>'sum(/collaborator/history_states/history_state/comment)'</code> \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u043e\u0442\u0432\u044f\u0437\u0430\u043d\u0430 \u043e\u0442 XML \u0441\u0445\u0435\u043c\u044b, \u0438\u043d\u0430\u0447\u0435 \u0431\u0443\u0434\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0430 \u0442\u0438\u043f\u043e\u0432</p> <p></p> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_10","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c XML \u0443\u0437\u0435\u043b","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430 \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0445 - <code>password</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/login)[1]','varchar(50)') as lastname\n        ,data.value('(/collaborator/password)[1]','varchar(50)') as password\n        ,data.exist('(/collaborator/password)') as exist_password\nfrom    collaborator\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u041d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u0443\u0437\u043b\u0435 <code>password</code> \u043d\u0435 \u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_11","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0440\u0430\u0432\u0435\u043d\u0441\u0442\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f XML \u0443\u0437\u043b\u0430 \u0441 \u043d\u0430\u0448\u0438\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0443\u0437\u043b\u043e\u043c <code>lastname</code> \u0438 \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>\u0418\u0432\u0430\u043d\u043e\u0432</code>. \u0420\u0435\u0433\u0438\u0441\u0442\u0440 \u0432\u0430\u0436\u0435\u043d</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/lastname)[1]','varchar(50)') as lastname\n        ,data.exist('(/collaborator/lastname[text()=\"\u0418\u0432\u0430\u043d\u043e\u0432\"])') as exist_lastname\nfrom    collaborator\norder by data.exist('(/collaborator/lastname[text()=\"\u0418\u0432\u0430\u043d\u043e\u0432\"])') desc\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_12","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430 \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0443","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/lastname)[1]','varchar(50)') as lastname\n        ,data.exist('/collaborator/lastname/text()[contains(., \"\u0432\u0430\u043d\")]') as exist_lastname\nfrom    collaborator\norder by data.exist('/collaborator/lastname/text()[contains(., \"\u0432\u0430\u043d\")]') desc\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>[contains(., \"\u0432\u0430\u043d\")]</code>. \u0424\u0443\u043d\u043a\u0446\u0438\u044f <code>contains(str, substr)</code> \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u0430 <code>str</code> \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0443 <code>substr</code>. \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>.</code> - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0441\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 <code>XPath</code> - \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0443\u0437\u043b\u0430 <code>lastname</code>. \u0420\u0435\u0433\u0438\u0441\u0442\u0440 \u0432\u0430\u0436\u0435\u043d</p>"},{"location":"materials/mssql-xml-tutorial/#webtutor","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044f \u0432 WebTutor","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0437\u0430\u043f\u0438\u0441\u0438, \u0433\u0434\u0435 <code>custom_elem</code> \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code> \u0438 \u0443\u0437\u0435\u043b <code>value</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>\u041a\u0438\u0440\u043e\u0432</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/lastname)[1]','varchar(50)') as lastname\n        ,data.value('(/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value)[1]','varchar(50)') as message_sent\n        ,data.exist('/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value[text() = \"\u041a\u0438\u0440\u043e\u0432\"]') as exist_result\nfrom    collaborator\norder by data.exist('/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value[text() = \"\u041a\u0438\u0440\u043e\u0432\"]') desc\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_13","title":"\u0420\u0430\u0437\u0434\u0435\u043b\u044f\u0435\u043c \u043f\u043e \u0440\u0430\u0437\u043d\u044b\u043c \u0441\u0442\u0440\u043e\u043a\u0430\u043c \u043a\u0430\u0436\u0434\u044b\u0439 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0439 XML \u0443\u0437\u0435\u043b","text":"<p>\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u043c\u0435\u044e\u0449\u0435\u0433\u043e\u0441\u044f \u0443\u0437\u043b\u0430 <code>custom_elem</code> \u0432\u044b\u0432\u0435\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0435\u0433\u043e \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0443\u0437\u043b\u043e\u0432</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/id)[1]','bigint') as id\n        ,Table1.field.query('.') as nodes_element\nfrom    collaborator\n        cross apply collaborator.data.nodes('(/collaborator/custom_elems/custom_elem)') as Table1(field)\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p>\u041f\u043e\u043b\u0443\u0447\u0438\u043c \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043a\u0430\u0436\u0434\u044b\u043c \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u043c <code>custom_elem</code>, \u043e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>.</code> \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 <code>query</code> \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u0432\u0441\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430</p> <p></p> <p>\u0414\u043e\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u0437\u0430\u043f\u0440\u043e\u0441 \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0432\u044b\u0432\u043e\u0434 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 \u0432\u043d\u0443\u0442\u0440\u0438 <code>custom_elem</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   data.value('(/collaborator/id)[1]','bigint') as id\n        ,Table1.field.query('.') as nodes_element\n        ,Table1.field.query('name') as nodes_name\n        ,Table1.field.query('./value') as nodes_value\nfrom    collaborator\n        cross apply collaborator.data.nodes('(/collaborator/custom_elems/custom_elem)') as Table1(field)\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p>\u0411\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u044f \u0442\u043e\u043c\u0443, \u0447\u0442\u043e \u043c\u0435\u0442\u043e\u0434 <code>nodes</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u0432\u043e\u0439 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442, \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043e\u0431\u0440\u0430\u0449\u0430\u0442\u044c\u0441\u044f \u043a \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u043c\u0443 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u044d\u0442\u043e\u0433\u043e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <p>\u0414\u043e\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u0437\u0430\u043f\u0440\u043e\u0441 \u0438 \u0434\u043b\u044f \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u0438\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f</p> <pre><code>select   data.value('(/collaborator/id)[1]','bigint') as id\n        ,Table1.field.query('.') as nodes_element\n        ,Table1.field.query('name').value('.', 'varchar(100)') as nodes_name\n        ,Table1.field.value('(./value)[1]', 'varchar(100)') as nodes_value\nfrom    collaborator\n        cross apply collaborator.data.nodes('(/collaborator/custom_elems/custom_elem)') as Table1(field)\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p>\u041c\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u0436\u0435\u043b\u0430\u0435\u043c\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442, \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044f \u0438 \u0435\u0433\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_14","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 XML \u0443\u0437\u043b\u043e\u0432 \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0443\u0440\u043e\u0432\u043d\u0435","text":"<p>\u0414\u043b\u044f \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0445 \u043d\u043e\u043c\u0435\u0440\u043e\u0432 \u043c\u044b \u0431\u0443\u0434\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0435\u0442\u043e\u0434 <code>nodes</code> \u0438 \u0435\u0433\u043e \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u044c, \u043f\u0440\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0443\u0437\u043b\u044b \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0442\u0441\u044f \u0432 \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u0438\u0445 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u044f \u0432 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435. \u041f\u043e\u043b\u0443\u0447\u0438\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u0432\u0441\u0435\u0445 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439 <code>custom_elem</code>.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   id\n        ,Table1.field.query('.') as query\n        ,Table1.field.value('count( for $s in (/collaborator/custom_elems/custom_elem) where $s &lt;&lt; . return(.) ) + 1', 'int') as node_number\n        ,row_number() over (partition by id order by id) as node_number_light\nfrom    collaborator\n        cross apply collaborator.data.nodes('(/collaborator/custom_elems/custom_elem)') as Table1(field)\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0412 \u043c\u0435\u0442\u043e\u0434\u0435 <code>value</code> \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441 <code>XQuery</code> \u0438 \u043f\u043e\u0431\u0438\u0442\u043e\u0432\u0430\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u044f <code>&lt;&lt;</code>. \u0413\u043e\u0432\u043e\u0440\u044f \u043f\u0440\u043e\u0441\u0442\u044b\u043c \u044f\u0437\u044b\u043a\u043e\u043c, \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>count( for $s in (/collaborator/custom_elems/custom_elem) where $s &lt;&lt; . return(.) )</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0432\u0441\u0435\u0445 \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043d\u043e\u0433\u043e \u043c\u0435\u0442\u043e\u0434\u043e\u043c <code>nodes</code></p> <p>\u0422\u043e \u0435\u0441\u0442\u044c, \u0434\u043b\u044f \u043f\u0435\u0440\u0432\u043e\u0433\u043e <code>custom_elem</code> \u043d\u0435\u0442 \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0443\u0437\u043b\u043e\u0432, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0431\u0443\u0434\u0435\u0442 \u0440\u0430\u0432\u043d\u043e <code>0</code>. \u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043c\u0435\u0442\u043e\u0434 <code>nodes</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0442\u043e\u0440\u043e\u0439 <code>custom_elem</code>, \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 \u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0441\u044f <code>1</code> \u0438 \u0442\u0430\u043a \u0434\u0430\u043b\u0435\u0435. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u043f\u0443\u0442\u044c \u0434\u043e \u0443\u0437\u043b\u0430 \u0432 \u043c\u0435\u0442\u043e\u0434\u0435 <code>nodes</code> \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0443\u0442\u0438 \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code>. \u0422\u0430\u043a \u043a\u0430\u043a \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432, \u0442\u043e \u043e\u0442\u0441\u0447\u0435\u0442 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441 <code>0</code>. \u0422\u0430\u043a \u043a\u0430\u043a \u0444\u0443\u043d\u043a\u0446\u0438\u044f <code>count</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0447\u0438\u0441\u043b\u043e, \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u044c \u043d\u0430\u0434 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u043c \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438</p> <p>\u0421\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0431\u043e\u043b\u0435\u0435 \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 \u0443\u0437\u043b\u043e\u0432, \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u043a\u043e\u043d\u043d\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>ROW_NUMBER</code>, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043b\u0435\u0433\u0447\u0435 \u0432 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u0438 \u0438 \u0434\u0430\u0451\u0442 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u0439 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p>"},{"location":"materials/mssql-xml-tutorial/#xml_15","title":"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c XML \u0443\u0437\u0435\u043b \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442","text":"<p>\u0414\u043e\u0431\u0430\u0432\u0438\u043c \u043d\u043e\u0432\u044b\u0439 \u0443\u0437\u0435\u043b <code>history_state</code> \u0432 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0439 <code>history_states</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>update  collaborator\nset     data.modify('insert\n                    &lt;history_state&gt;\n                        &lt;id&gt;hpb91b&lt;/id&gt;\n                        &lt;state_id&gt;vacation&lt;/state_id&gt;\n                        &lt;start_date&gt;2025-01-01T00:00:00+00:00&lt;/start_date&gt;\n                        &lt;finish_date&gt;2025-09-09T00:00:00+00:00&lt;/finish_date&gt;\n                        &lt;comment&gt;9&lt;/comment&gt;\n                    &lt;/history_state&gt;\n                    into\n                    (collaborator/history_states)[1]\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;3&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;3&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91b&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2025-01-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2025-09-09T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;9&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p></p> <p>\u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>into</code> \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442 \u0443\u0437\u0435\u043b \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u043f\u043e\u0442\u043e\u043c\u043a\u043e\u043c. \u0414\u043b\u044f \u0442\u043e\u0447\u043d\u043e\u0433\u043e \u0443\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u043c\u0435\u0441\u0442\u0430 \u0432\u0441\u0442\u0430\u0432\u043a\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 <code>as first</code> \u0438 <code>as last</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>update  collaborator\nset     data.modify('insert\n                    &lt;history_state&gt;\n                        &lt;id&gt;hpb91c&lt;/id&gt;\n                        &lt;state_id&gt;vacation&lt;/state_id&gt;\n                        &lt;start_date&gt;2026-01-01T00:00:00+00:00&lt;/start_date&gt;\n                        &lt;finish_date&gt;2026-09-09T00:00:00+00:00&lt;/finish_date&gt;\n                        &lt;comment&gt;9&lt;/comment&gt;\n                    &lt;/history_state&gt;\n                    as first into\n                    (collaborator/history_states)[1]\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;3&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91b&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2025-01-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2025-09-09T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;9&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91c&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2026-01-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2026-09-09T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;9&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;3&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91b&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2025-01-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2025-09-09T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;9&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_16","title":"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c XML \u0443\u0437\u0435\u043b \u043d\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0443\u044e \u043f\u043e\u0437\u0438\u0446\u0438\u044e","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>declare @comment varchar(100) = '\u0412\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442';\n\nupdate  collaborator\nset     data.modify('insert\n                    &lt;comment&gt;{ sql:variable(\"@comment\") }&lt;/comment&gt;\n                    after\n                    (collaborator/history_states/history_state[1]/finish_date)[1]\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u0412\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_17","title":"\u0423\u0434\u0430\u043b\u044f\u0435\u043c XML \u0443\u0437\u0435\u043b \u0441 \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>update  collaborator\nset     data.modify('delete\n                    (collaborator/history_states/history_state[last()])\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u0412\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442&lt;/comment&gt;\n        &lt;/history_state&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;hpb91a&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-16T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-23T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;7&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u0412\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p></p>"},{"location":"materials/mssql-xml-tutorial/#_2","title":"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0443\u0437\u043b\u0430","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>update  collaborator\nset     data.modify('replace value of\n                    (collaborator/history_states/history_state[1]/comment/text())[1]\n                    with\n                    \"\u041e\u0431\u043d\u043e\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439\"\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u0412\u0441\u0442\u0430\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u041e\u0431\u043d\u043e\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p></p>"},{"location":"materials/mssql-xml-tutorial/#_3","title":"\u0417\u0430\u043c\u0435\u043d\u044f\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c \u0438\u0437 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>declare @comment varchar(100) = '\u043a\u043e\u0442\u043e\u043c\u0451\u0442'\n\nupdate  collaborator\nset     data.modify('replace value of\n                    (collaborator/history_states/history_state[1]/comment/text())[1]\n                    with\n                    sql:variable(\"@comment\")\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u041e\u0431\u043d\u043e\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u043a\u043e\u0442\u043e\u043c\u0451\u0442&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#_4","title":"\u0417\u0430\u043c\u0435\u043d\u044f\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c \u0438\u0437 \u0434\u0440\u0443\u0433\u043e\u0433\u043e \u043f\u043e\u043b\u044f","text":"<p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>update  collaborator\nset     data.modify('replace value of\n                    (collaborator/history_states/history_state[1]/comment/text())[1]\n                    with\n                    sql:column(\"id\")\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> XML \u0434\u043eXML \u043f\u043e\u0441\u043b\u0435 <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;\u041e\u0431\u043d\u043e\u0432\u0438\u043b\u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;history_states&gt;\n        &lt;history_state&gt;\n            &lt;id&gt;92d6c6&lt;/id&gt;\n            &lt;state_id&gt;vacation&lt;/state_id&gt;\n            &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n            &lt;finish_date&gt;2024-09-03T00:00:00+00:00&lt;/finish_date&gt;\n            &lt;comment&gt;6148914691236517121&lt;/comment&gt;\n        &lt;/history_state&gt;\n    &lt;/history_states&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre>"},{"location":"materials/mssql-xml-tutorial/#_5","title":"\u0421\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u043e\u043b\u0435\u0439 \u0432 \u043e\u0434\u043d\u043e\u043c \u043f\u043e\u043b\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443","text":"<p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> <p>\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u0441 \u043c\u043e\u0431\u0438\u043b\u044c\u043d\u044b\u043c\u0438 \u043d\u043e\u043c\u0435\u0440\u0430\u043c\u0438</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>select   login\n        ,rtrim(ltrim(substring(phone_number, 2, 50))) as phone_number\nfrom    (\n            select   login\n                    ,(  \n                        select  '; ' + cast(phone_number as varchar)\n                        from    phone_numbers\n                        where   A.login = login\n                        order by login, phone_number\n                        for     xml path('')\n                        ) as phone_number\n            from    phone_numbers A\n        ) A\ngroup by login, phone_number\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#_6","title":"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u043d\u043e\u0439 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439","text":"<p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>with tree (  id\n            ,name\n            ,pathstr\n          ) as\n(\n    select  id\n            ,name\n            ,CAST(name as varchar(max))\n    from    subdivisions\n    where   parent_object_id is null\n\n    union all\n\n    select   S.id\n            ,S.name\n            ,t.pathstr + '/'+ S.name\n    from    subdivisions S inner join tree T on T.id = S.parent_object_id\n)\n\nselect  id\n        ,pathstr\n        ,CAST('&lt;sub&gt;' + REPLACE(pathstr, '/', '&lt;/sub&gt;&lt;sub&gt;') + '&lt;/sub&gt;' as xml) as pathstrXML\nfrom    tree\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041d\u0430 \u0440\u0438\u0441\u0443\u043d\u043a\u0435 \u043c\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u043f\u043e\u043b\u043d\u044b\u0439 \u043f\u0443\u0442\u044c \u0434\u043e \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f, \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0438\u0437 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0439 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439. \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0441\u0442\u043e\u043b\u0431\u0435\u0446 <code>pathstrXML</code> - \u044d\u0442\u043e \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u044b\u0439 \u0441\u0442\u043e\u043b\u0431\u0435\u0446 \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0445 \u0440\u0430\u0431\u043e\u0442</p> <p>\u0412\u0410\u0416\u041d\u041e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c, \u0432 \u043d\u0430\u0448\u0435\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u044d\u0442\u043e <code>/</code>, \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0441\u043b\u0443\u0447\u0430\u044f\u0445 \u0435\u0433\u043e \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u0441\u044f \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0435, \u0435\u0441\u043b\u0438 \u0432 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f\u0445 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u0441\u0438\u043c\u0432\u043e\u043b <code>/</code> \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0447\u0430\u0441\u0442\u044c\u044e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f</p> <p>\u0412\u0410\u0416\u041d\u041e</p> <p>\u0422\u0430\u043a \u0436\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u0441\u044f \u0441 \u043e\u0448\u0438\u0431\u043a\u043e\u0439, \u0435\u0441\u043b\u0438 \u0432 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f\u0445 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u0440\u0438\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442 \u0441\u0438\u043c\u0432\u043e\u043b\u044b <code>&gt;</code>, <code>&lt;</code>, <code>&amp;</code>. \u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u043e\u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0441\u043e\u0431\u0440\u0430\u0442\u044c XML \u0438\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0439 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439, \u0447\u0442\u043e\u0431\u044b \u043e\u0431\u043e\u0439\u0442\u0438 \u044d\u0442\u0443 \u043e\u0448\u0438\u0431\u043a\u0443, \u044d\u0442\u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u0441\u043b\u0435\u0434\u0443\u0435\u0442 \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 HTML-\u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 (<code>&amp;</code> -&gt; <code>&amp;amp;</code>)</p>"},{"location":"materials/mssql-xml-tutorial/#_7","title":"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u0432\u043d\u0438\u0437, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0433\u043e \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f","text":"<p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439, \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \"\u041e\u0442\u0434\u0435\u043b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0438 \u0440\u0430\u0437\u0432\u0438\u0442\u0438\u044f\" \u0438 \u0432\u0441\u0435 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>declare @sub_id bigint = 6327975429225669223;\n\nwith tree (id, name) as (\n    select  id, name\n    from    [subdivisions]\n    where   id = @sub_id\n    union all\n    select  V.id, v.name\n    from    [subdivisions] V inner join tree t on t.id = V.parent_object_id\n)\n\nselect  A.id, A.name\nfrom    tree A\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#_8","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u043e \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0432\u0432\u0435\u0440\u0445, \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0441\u0430\u043c\u043e \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435","text":"<p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> <p>\u0421\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439, \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0448\u0442\u0430\u0442\u043d\u043e\u0435 \u0440\u0430\u0441\u043f\u0438\u0430\u043d\u0438\u0435 \u0434\u043b\u044f \"\u041e\u0442\u0434\u0435\u043b \u0434\u0438\u0441\u0442\u0430\u043d\u0446\u0438\u043e\u043d\u043d\u043e\u0433\u043e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f\"</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 <pre><code>with tree (id, name, parent_object_id, level) as (\n    select   A.id\n            ,A.name\n            ,A.parent_object_id \n            ,1\n    from    subdivisions A \n    where   A.id = 6327975429225669224\n\n    union all \n\n    select   A.id\n            ,A.name\n            ,A.parent_object_id\n            ,B.level + 1\n    from    subdivisions A inner join tree B on A.id = B.parent_object_id\n) \n\nselect  A.*\n        ,(select max(level) from tree) - A.level + (select min(level) from tree) as reverse_level\nfrom    tree A\n</code></pre></p> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#xml_18","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f XML \u0443\u0437\u043b\u043e\u0432 \u0438 \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c","text":"<p>\u0421\u043e\u0431\u0435\u0440\u0435\u043c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0432 \u043e\u0434\u043d\u0443 \u0441\u0442\u0440\u043e\u043a\u0443 \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c</p> <p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> \u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430XML <p></p> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;category_id&gt;access_admin&lt;/category_id&gt;\n    &lt;category_id&gt;access_api&lt;/category_id&gt;\n    &lt;category_id&gt;access_portal&lt;/category_id&gt;\n&lt;/collaborator&gt;\n</code></pre> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>select   id\n        ,data.query('for $elem in collaborator/category_id return &lt;s&gt;{concat($elem, \";\")}&lt;/s&gt;').value('.', 'varchar(max)')\nfrom    collaborator\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/mssql-xml-tutorial/#_9","title":"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0443\u0437\u043b\u043e\u0432 \u0431\u0435\u0437 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432","text":"<p>\u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 - \u043f\u0443\u0441\u0442\u044b\u0435 \u0443\u0437\u043b\u044b custom_elem, \u043d\u0443\u0436\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0438\u0445 \u0438\u0437 XML</p> <p>\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435</p> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;custom_elems&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_city&lt;/name&gt;\n            &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n        &lt;/custom_elem&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_sex&lt;/name&gt;\n            &lt;value&gt;\u041c&lt;/value&gt;\n        &lt;/custom_elem&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_birth_date&lt;/name&gt;\n            &lt;value&gt;1988-06-02T00:00:00+00:00&lt;/value&gt;\n        &lt;/custom_elem&gt;\n        &lt;custom_elem /&gt;\n        &lt;custom_elem /&gt;\n        &lt;custom_elem /&gt;\n        &lt;custom_elem /&gt;\n        &lt;custom_elem /&gt;\n        &lt;custom_elem /&gt;\n    &lt;/custom_elems&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <p>\u0414\u043b\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043f\u0443\u0441\u0442\u044b\u0445 \u0443\u0437\u043b\u043e\u0432 \u0432 XML \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>node()</code>, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0441\u0435 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0435 \u0443\u0437\u043b\u044b</p> <pre><code>update  collaborator\nset     data.modify('\n          delete\n          (collaborator/custom_elems/custom_elem[count(node())=0])\n        ')\nwhere   id = 6148914691236517121\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <pre><code>&lt;collaborator SPXML-FORM=\"x-local://wtv/wtv_collaborator.xmd\"&gt;\n    &lt;id&gt;6148914691236517121&lt;/id&gt;\n    &lt;lastname&gt;\u0418\u0432\u0430\u043d\u043e\u0432&lt;/lastname&gt;\n    ...\n    &lt;custom_elems&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_city&lt;/name&gt;\n            &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n        &lt;/custom_elem&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_sex&lt;/name&gt;\n            &lt;value&gt;\u041c&lt;/value&gt;\n        &lt;/custom_elem&gt;\n        &lt;custom_elem&gt;\n            &lt;name&gt;fld_birth_date&lt;/name&gt;\n            &lt;value&gt;1988-06-02T00:00:00+00:00&lt;/value&gt;\n        &lt;/custom_elem&gt;\n    &lt;/custom_elems&gt;\n    ...\n&lt;/collaborator&gt;\n</code></pre>"},{"location":"materials/postgres-xml-tutorial/","title":"\u0428\u043f\u0430\u0440\u0433\u0430\u043b\u043a\u0430 \u043f\u043e \u0440\u0430\u0431\u043e\u0442\u0435 \u0441 \u043f\u043e\u043b\u044f\u043c\u0438 XML \u0432 Postgres","text":"<p>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f \u043f\u043e PostgreSQL \u043d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435 \u0442\u0443\u0442</p> <p>\u0421 \u0442\u0438\u043f\u0430\u043c\u0438 PostgreSQL \u043c\u043e\u0436\u043d\u043e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u043f\u043e \u044d\u0442\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435</p> <p>\u0421 \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c\u0438 \u043c\u0430\u0441\u0441\u0438\u0432\u043e\u0432 \u043c\u043e\u0436\u043d\u043e \u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u043f\u043e \u044d\u0442\u043e\u0439 \u0441\u0441\u044b\u043b\u043a\u0435</p>"},{"location":"materials/postgres-xml-tutorial/#_1","title":"\u0412\u0432\u043e\u0434\u043d\u044b\u0435 \u043f\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u044f\u043c","text":"<p>\u041d\u0443\u043c\u0435\u0440\u0430\u0446\u0438\u044f \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 XML \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0445 \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0441 1</p>"},{"location":"materials/postgres-xml-tutorial/#xpath","title":"\u0424\u0443\u043d\u043a\u0446\u0438\u044f xpath","text":"<p>\u0424\u0443\u043d\u043a\u0446\u0438\u044f <code>xpath</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 <code>XML</code>, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044e <code>XPath</code>. \u0415\u0441\u043b\u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 <code>XPath</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0441\u043a\u0430\u043b\u044f\u0440\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, <code>xpath</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u0438\u0437 \u043e\u0434\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath('/collaborator/category_id', data) AS cats\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> pgAdminXML[] <p></p> <pre><code>&lt;category_id&gt;cat_1&lt;/category_id&gt;,\n&lt;category_id&gt;cat_2&lt;/category_id&gt;\n</code></pre>"},{"location":"materials/postgres-xml-tutorial/#xpath_exists","title":"\u0424\u0443\u043d\u043a\u0446\u0438\u044f xpath_exists","text":"<p>\u0424\u0443\u043d\u043a\u0446\u0438\u044f <code>xpath_exists</code> \u0432 PostgreSQL \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442, \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0442 \u043b\u0438 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u044b, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044e <code>XPath</code>.</p> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0435\u0451 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u2014 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>Boolean</code>, \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0449\u0435\u0435, \u0431\u0443\u0434\u0435\u0442 \u043b\u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043e \u043a\u0430\u043a\u043e\u0435-\u043b\u0438\u0431\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043a\u0440\u043e\u043c\u0435 \u043f\u0443\u0441\u0442\u043e\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430 \u0443\u0437\u043b\u043e\u0432.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath_exists('/collaborator/category_id', data) AS bcats\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#unnest","title":"\u0424\u0443\u043d\u043a\u0446\u0438\u044f unnest","text":"<p>\u0424\u0443\u043d\u043a\u0446\u0438\u044f <code>unnest()</code> \u0432 PostgreSQL \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u0432 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0430 \u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u044f\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u0430\u0441\u0441\u0438\u0432 \u0432 \u043d\u0430\u0431\u043e\u0440 \u0441\u0442\u0440\u043e\u043a. \u041f\u0440\u043e\u0449\u0435 \u0433\u043e\u0432\u043e\u0440\u044f, <code>unnest</code> \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u0432 \u0442\u0430\u0431\u043b\u0438\u0447\u043d\u0443\u044e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0443.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  unnest(xpath('/collaborator/category_id', data)) AS bcats\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_2","title":"\u041f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u0442\u0438\u043f\u043e\u0432","text":"<p>\u0414\u043b\u044f \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0442\u0438\u043f\u043e\u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>CAST (exp AS data_type)</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT CAST ('572' AS INTEGER);\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0427\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0443\u043a\u043e\u0440\u043e\u0447\u0435\u043d\u043d\u044b\u0439 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0438\u044f</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT '572'::INTEGER;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_3","title":"\u0421\u0431\u043e\u0440\u043d\u0438\u043a \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432","text":""},{"location":"materials/postgres-xml-tutorial/#xml","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u0435\u0440\u0432\u044b\u0439 XML \u0443\u0437\u0435\u043b \u043f\u043e \u0435\u0433\u043e \u0438\u043c\u0435\u043d\u0438","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>lastname</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   xpath('/collaborator/lastname[1]', data) AS lastname\n        ,xpath('/collaborator/lastname[2]', data) AS lastname\n        ,(xpath('/collaborator/lastname', data))[1] AS lastname\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u041f\u0435\u0440\u0432\u044b\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0432\u0435\u0440\u043d\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u0441 \u0443\u0437\u043b\u043e\u043c <code>lastname</code> \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c 1 \u0412\u0442\u043e\u0440\u043e\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0432\u0435\u0440\u043d\u0435\u0442 \u043f\u0443\u0441\u0442\u043e\u0439 \u043c\u0430\u0441\u0441\u0438\u0432, \u0442\u0430\u043a \u043a\u0430\u043a \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435 \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0443\u0437\u0435\u043b <code>lastname</code> \u0441 \u0438\u043d\u0434\u0435\u043a\u0441\u043e\u043c 2 \u0422\u0440\u0435\u0442\u0438\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043f\u0435\u0440\u0432\u044b\u0439 \u0443\u0437\u0435\u043b <code>lastname</code> \u0438\u0437 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u0443\u0437\u043b\u043e\u0432 <code>lastname</code></p>"},{"location":"materials/postgres-xml-tutorial/#xml_1","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0432\u0441\u0435 XML \u0443\u0437\u043b\u044b \u043f\u043e \u0438\u043c\u0435\u043d\u0438","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0443\u0437\u043b\u044b \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>category_id</code>. \u041a\u0430\u0436\u0434\u0430\u044f \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f, \u043f\u0440\u0438\u0441\u0432\u043e\u0435\u043d\u043d\u0430\u044f \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0443, \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u043c <code>&lt;category_id&gt;...&lt;/category_id&gt;</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath('/collaborator/category_id', data) AS cats\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> pgAdminXML[] <p></p> <pre><code>&lt;category_id&gt;cat_1&lt;/category_id&gt;,\n&lt;category_id&gt;cat_2&lt;/category_id&gt;\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p><code>xpath</code> \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u0443\u0437\u043b\u043e\u0432</p>"},{"location":"materials/postgres-xml-tutorial/#xml_2","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u0441\u043e \u0432\u0441\u0435\u043c \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u044b\u043c","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u043b\u044b \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439 \u0441 \u0435\u0433\u043e \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u0435\u043c. \u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 \u0443\u0437\u043b\u0430\u0445 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c <code>custom_elem</code>, \u043a\u043e\u0440\u043d\u0435\u0432\u043e\u0439 \u0443\u0437\u0435\u043b \u0434\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0445 <code>custom_elems</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath('/collaborator/custom_elems', data) AS custom_elems\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> pgAdminXML[] <p></p> <pre><code>&lt;custom_elems&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;f_nj0z&lt;/name&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;field1&lt;/name&gt;\n        &lt;value&gt;0x61FD2936115CA629&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;field2&lt;/name&gt;\n        &lt;value&gt;sdfsfsfsdfsf&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_doc&lt;/name&gt;\n        &lt;value&gt;0x61ADE372EBEAD381&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_relation&lt;/name&gt;\n        &lt;value&gt;0x61FD2D422FA94E42&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_city&lt;/name&gt;\n        &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_comment&lt;/name&gt;\n        &lt;value&gt;\u0427\u0442\u043e-\u0442\u043e \u0443\u043c\u0435\u0435\u0442 \u0434\u0435\u043b\u0430\u0442\u044c&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_age&lt;/name&gt;\n        &lt;value&gt;36&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_weight&lt;/name&gt;\n        &lt;value&gt;74&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_birth_date&lt;/name&gt;\n        &lt;value&gt;1988-06-02T00:00:00&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_married&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_sex&lt;/name&gt;\n        &lt;value&gt;\u041c&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;fld_skills&lt;/name&gt;\n        &lt;value&gt;\u041e\u0444\u0438\u0441;Javascript&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_javascript&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_PHP&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_Docker&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_Kerberos&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_HTML&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_WebTutor&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n&lt;/custom_elems&gt;\n</code></pre>"},{"location":"materials/postgres-xml-tutorial/#xml_3","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u0435\u0433\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0443","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>custom_elem</code> \u043f\u043e \u0435\u0433\u043e \u0438\u043d\u0434\u0435\u043a\u0441\u0443</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   xpath('/collaborator/custom_elems/custom_elem[6]', data) AS custom_elem\n        ,(xpath('/collaborator/custom_elems/custom_elem', data))[6] AS custom_elem\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> pgAdminXML[]XML <p></p> <pre><code>&lt;custom_elem&gt;\n    &lt;name&gt;fld_city&lt;/name&gt;\n    &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n&lt;/custom_elem&gt;\n</code></pre> <pre><code>&lt;custom_elem&gt;\n    &lt;name&gt;fld_city&lt;/name&gt;\n    &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n&lt;/custom_elem&gt;\n</code></pre> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u0412 \u043f\u0435\u0440\u0432\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043c\u0430\u0441\u0441\u0438\u0432 <code>xml</code>, \u0432\u043e \u0432\u0442\u043e\u0440\u043e\u043c \u0443\u0437\u0435\u043b <code>xml</code></p>"},{"location":"materials/postgres-xml-tutorial/#xml_4","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0435\u0433\u043e \u0432\u043b\u043e\u0436\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>custom_elem</code> \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath('/collaborator/custom_elems/custom_elem[name=\"fld_city\"]', data) AS custom_elem\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> pgAdminXML[] <p></p> <pre><code>&lt;custom_elem&gt;\n    &lt;name&gt;fld_city&lt;/name&gt;\n    &lt;value&gt;\u041a\u0438\u0440\u043e\u0432&lt;/value&gt;\n&lt;/custom_elem&gt;\n</code></pre> <p>\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>...custom_elem[name=\"fld_city\"]...</code> \u0438\u0449\u0435\u0442 \u0443\u0437\u0435\u043b <code>custom_elem</code> \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code> \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 <code>custom_elem</code></p>"},{"location":"materials/postgres-xml-tutorial/#xml-xml","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c XML \u0443\u0437\u0435\u043b \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e \u0441\u043e\u0441\u0435\u0434\u043d\u0435\u0433\u043e XML \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0443\u0437\u0435\u043b <code>value</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u043b\u043e\u0436\u0435\u043d \u0432 \u0443\u0437\u0435\u043b <code>custom_elem</code>, \u0433\u0434\u0435 \u0442\u0430\u043a \u0436\u0435 \u0432\u043b\u043e\u0436\u0435\u043d \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT  xpath('/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value', data) AS custom_elem_city\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_5","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432 \u0441 \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u043c\u0438 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 (\u0418\u0414, \u0444\u0430\u043c\u0438\u043b\u0438\u044e, \u0434\u0430\u0442\u0443 \u0440\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0438 \u0444\u043b\u0430\u0433 \u0443\u0432\u043e\u043b\u0435\u043d \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a \u0438\u043b\u0438 \u043d\u0435\u0442) \u0438 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043c \u0438\u0445 \u043a \u043f\u0440\u0438\u043c\u0438\u0442\u0438\u0432\u043d\u044b\u043c \u0442\u0438\u043f\u0430\u043c</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/id/text()', data))[1]::TEXT::BIGINT AS id\n        ,(xpath('/collaborator/lastname/text()', data))[1]::TEXT AS lastname\n        ,(xpath('/collaborator/birth_date/text()', data))[1]::TEXT::DATE AS birth_date\n        ,(xpath('/collaborator/is_dismiss/text()', data))[1]::TEXT::BOOLEAN AS is_dismiss\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u0415\u0441\u043b\u0438 \u043f\u043e\u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u043f\u0440\u0438\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u043b\u0435 <code>lastname</code> \u043a \u0434\u0430\u0442\u0435, \u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u043e\u0448\u0438\u0431\u043a\u0443</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_4","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f <code>value</code> \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0445 \u043f\u043e\u043b\u0435\u0439 \u0441 \u0438\u043c\u0435\u043d\u0430\u043c\u0438 <code>fld_city</code>, <code>fld_birth_date</code> \u0438 <code>fld_skills</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/custom_elems/custom_elem[name=\"fld_city\"]/value/text()', data))[1]::TEXT\n        ,(xpath('/collaborator/custom_elems/custom_elem[name=\"fld_birth_date\"]/value/text()', data))[1]::TEXT::TIMESTAMP\n        ,(xpath('/collaborator/custom_elems/custom_elem[name=\"fld_skills\"]/value/text()', data))[1]::TEXT\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_5","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u0443\u0437\u043b\u043e\u0432 \u0438\u0437 \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u0438\u0445 \u0443\u0437\u043b\u043e\u0432","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 <code>history_states</code> \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 <code>history_state</code>, \u043f\u043e\u043b\u0435 <code>state_id</code> \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 <code>vacation</code>, \u0438 \u0432\u044b\u0432\u0435\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432 <code>start_date</code> \u0438 <code>finish_date</code> \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 \u0434\u0430\u0442\u044b</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/history_states/history_state[state_id=\"vacation\"]/start_date/text()', data))::TEXT[]::TIMESTAMP[]\n        ,(xpath('/collaborator/history_states/history_state[state_id=\"vacation\"]/finish_date/text()', data))::TEXT[]::TIMESTAMP[]\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u0412 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 2 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f \u0441 \u043a\u043e\u0434\u043e\u043c <code>vacation</code>, \u0430 \u043a\u0430\u043a \u043c\u044b \u0443\u0436\u0435 \u0437\u043d\u0430\u0435\u043c, <code>xpath</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 <code>xml</code>. \u0421\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0438 \u043f\u0440\u0438\u0432\u0438\u0434\u0435\u043d\u0438\u0435 \u0442\u0438\u043f\u043e\u0432 \u0442\u043e\u0436\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u043c\u0430\u0441\u0441\u0438\u0432\u043e\u0432.</p>"},{"location":"materials/postgres-xml-tutorial/#xml_6","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0439 XML \u0443\u0437\u0435\u043b","text":"<p>\u041a\u043e\u0433\u0434\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0443\u0437\u043b\u043e\u0432 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u043e, \u043c\u043e\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u0443\u0437\u0435\u043b \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>last()</code>, \u043f\u0440\u0435\u0434\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 <code>last()-1</code> \u0438 \u0442.\u0434.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/custom_elems/custom_elem[last()]/name/text()', data))[1]::TEXT\n        ,(xpath('/collaborator/custom_elems/custom_elem[last()-1]/name/text()', data))[1]::TEXT\n        ,(xpath('/collaborator/custom_elems/custom_elem[last()-2]/name/text()', data))[1]::TEXT\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_7","title":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 \u0434\u043b\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 XML \u0443\u0437\u043b\u043e\u0432","text":"<p>\u0423 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0435\u0441\u0442\u044c 2 \u043e\u0442\u043f\u0443\u0441\u043a\u0430. \u0412 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u044f\u0445 \u043a \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044e \u0445\u0440\u0430\u043d\u0438\u0442\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043d\u0435\u0439 \u043e\u0442\u043f\u0443\u0441\u043a\u0430. \u041d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043e\u0442\u043f\u0443\u0441\u043a\u043e\u0432 \u0438 \u0438\u0445 \u0441\u0443\u043c\u043c\u0443 \u0434\u043d\u0435\u0439. \u0414\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u043c 2 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>count()</code> \u0438 <code>sum()</code></p> <p>XML \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0439 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430</p> <pre><code>&lt;history_states&gt;\n    &lt;history_state&gt;\n        &lt;id&gt;y8gr8e&lt;/id&gt;\n        &lt;state_id&gt;vacation&lt;/state_id&gt;\n        &lt;start_date&gt;2024-10-01T00:00:00+00:00&lt;/start_date&gt;\n        &lt;finish_date&gt;2024-10-06T00:00:00+00:00&lt;/finish_date&gt;\n        &lt;comment&gt;6&lt;/comment&gt;\n    &lt;/history_state&gt;\n    &lt;history_state&gt;\n        &lt;id&gt;7sgn58&lt;/id&gt;\n        &lt;state_id&gt;g5k8&lt;/state_id&gt;\n        &lt;start_date&gt;2024-09-01T00:00:00+00:00&lt;/start_date&gt;\n        &lt;finish_date&gt;2024-09-04T00:00:00+00:00&lt;/finish_date&gt;\n        &lt;comment&gt;4&lt;/comment&gt;\n    &lt;/history_state&gt;\n    &lt;history_state&gt;\n        &lt;id&gt;mvchh6&lt;/id&gt;\n        &lt;state_id&gt;vacation&lt;/state_id&gt;\n        &lt;start_date&gt;2025-01-01T00:00:00+00:00&lt;/start_date&gt;\n        &lt;finish_date&gt;2025-01-31T00:00:00+00:00&lt;/finish_date&gt;\n        &lt;comment&gt;30&lt;/comment&gt;\n    &lt;/history_state&gt;\n&lt;/history_states&gt;\n</code></pre> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('sum(/collaborator/history_states/history_state[state_id=\"vacation\"]/comment/text())', data))[1]::TEXT::INTEGER AS sum\n        ,(xpath('count(/collaborator/history_states/history_state[state_id=\"vacation\"]/comment/text())', data))[1]::TEXT::INTEGER AS count\nFROM    dbo.collaborator\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_8","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430","text":"<p>\u041f\u0440\u043e\u0432\u0435\u0440\u0438\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0443\u0437\u043b\u0430 <code>password</code> \u0438 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 <code>password</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   CLS.login\n        ,xpath('/collaborator/password', CL.data) AS pwd\n        ,xpath_exists('/collaborator/password', CL.data) AS pwd_exist\n        ,xpath_exists('/collaborator/password/text()', CL.data) AS pwd_text_exist\nFROM    dbo.collaborators CLS INNER JOIN dbo.collaborator CL ON CLS.id = Cl.id\nORDER BY xpath_exists('/collaborator/password/text()', CL.data) ASC\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435</p> <p>\u041d\u0430\u043b\u0438\u0447\u0438\u0435 \u0443\u0437\u043b\u0430 <code>&lt;password&gt;&lt;/password&gt;</code> \u0438 \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0443\u0437\u043b\u0430 <code>&lt;password&gt;111&lt;/password&gt;</code> \u0431\u0443\u0434\u0443\u0442 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u043f\u043e \u0440\u0430\u0437\u043d\u043e\u043c\u0443</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_9","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0440\u0430\u0432\u0435\u043d\u0441\u0442\u0432\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f XML \u0443\u0437\u043b\u0430 \u0441 \u043d\u0430\u0448\u0438\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0443\u0437\u043b\u043e\u043c <code>login</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>user1</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/login/text()', data))[1]::TEXT AS login\n        ,(xpath('/collaborator/login/text() = \"user1\"', data))[1]::TEXT::BOOLEAN AS login_xpath\n        ,xpath_exists('/collaborator/login[text() = \"user1\"]', data) AS login_xpath_exist\nFROM    dbo.collaborator\nORDER BY (xpath('/collaborator/login/text()', data))[1]::TEXT DESC\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_10","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043b\u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 XML \u0443\u0437\u043b\u0430 \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0443","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435\u0445 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u043e\u0432 \u0434\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u0430\u0440\u043e\u043b\u044c (\u0443\u0437\u0435\u043b <code>password</code>) \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0432 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0438 <code>1234</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/login/text()', data))[1]::TEXT AS login\n        ,(xpath('/collaborator/password/text()', data))[1]::TEXT AS password\n        ,xpath_exists('(/collaborator/password/text()[contains(., \"1234\")])', data) AS password_1234\nFROM    dbo.collaborator\nORDER BY xpath_exists('(/collaborator/password/text()[contains(., \"1234\")])', data) DESC\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f <code>[contains(., \"1234\")]</code>. \u0424\u0443\u043d\u043a\u0446\u0438\u044f <code>contains(str, substr)</code> \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442, \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u0430 <code>str</code> \u043f\u043e\u0434\u0441\u0442\u0440\u043e\u043a\u0443 <code>substr</code>. \u041e\u043f\u0435\u0440\u0430\u0442\u043e\u0440 <code>.</code> - \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0432\u0441\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0435 \u043f\u0440\u0435\u0434\u0448\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0435\u043c\u0443 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 <code>XPath</code> - \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430 <code>password</code>.</p>"},{"location":"materials/postgres-xml-tutorial/#webtutor","title":"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044f \u0432 WebTutor","text":"<p>\u041d\u0430\u0439\u0434\u0435\u043c \u0432\u0441\u0435 \u0437\u0430\u043f\u0438\u0441\u0438, \u0433\u0434\u0435 \u0443\u0437\u0435\u043b <code>custom_elem</code> \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0443\u0437\u0435\u043b <code>name</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>fld_city</code> \u0438 \u0443\u0437\u0435\u043b <code>value</code> \u0441\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c <code>\u041a\u0438\u0440\u043e\u0432</code></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/login/text()', data))[1]::TEXT AS login\n        ,(xpath('/collaborator/custom_elems/custom_elem[name = \"fld_city\"]/value/text()', data))[1]::TEXT\n        ,xpath_exists('/collaborator/custom_elems/custom_elem[name = \"fld_city\" and value = \"\u041a\u0438\u0440\u043e\u0432\"]', data)\nFROM    dbo.collaborator\nWHERE   xpath_exists('/collaborator/custom_elems/custom_elem[name = \"fld_city\"]/value/text()', data)\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_11","title":"\u0420\u0430\u0437\u0434\u0435\u043b\u044f\u0435\u043c \u043f\u043e \u0440\u0430\u0437\u043d\u044b\u043c \u0441\u0442\u0440\u043e\u043a\u0430\u043c \u043a\u0430\u0436\u0434\u044b\u0439 \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0439 XML \u0443\u0437\u0435\u043b","text":"<p>\u0414\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0438\u043c\u0435\u044e\u0449\u0435\u0433\u043e\u0441\u044f \u0443\u0437\u043b\u0430 <code>custom_elem</code> \u0432 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0435, \u0432\u044b\u0432\u0435\u0434\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0435\u0433\u043e \u0434\u043e\u0447\u0435\u0440\u043d\u0438\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/lastname/text()', CL.data))[1]::TEXT\n        ,(xpath('/custom_elem/name/text()', cstm))[1]::TEXT AS name\n        ,(xpath('/custom_elem/value/text()', cstm))[1]::TEXT AS value\nFROM    dbo.collaborator CL\n        CROSS JOIN unnest(xpath('/collaborator/custom_elems/custom_elem', data)) cstm\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0412 \u0434\u0430\u043d\u043d\u043e\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u044f <code>unnest</code> \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0442 \u043d\u0430 \u0432\u0445\u043e\u0434 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f <code>XPath</code>, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432 \u0441\u0432\u043e\u044e \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043c\u0430\u0441\u0441\u0438\u0432 XML, \u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0442\u0430\u0431\u043b\u0438\u0447\u043d\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u043e\u0433\u043e <code>XML</code>, \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u043c\u044b \u0441\u043d\u043e\u0432\u0430 \u043c\u043e\u0436\u0435\u043c \u043e\u0431\u0440\u0430\u0449\u0430\u0442\u044c\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>xpath</code>.</p>"},{"location":"materials/postgres-xml-tutorial/#xml_12","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u043e\u0432\u044b\u0435 \u043d\u043e\u043c\u0435\u0440\u0430 XML \u0443\u0437\u043b\u043e\u0432 \u043d\u0430 \u043e\u0434\u043d\u043e\u043c \u0443\u0440\u043e\u0432\u043d\u0435","text":"<p>\u0414\u043b\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u0438 <code>unnest</code> \u043c\u043e\u0436\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u043e\u043f\u0446\u0438\u044e <code>WITH ORDINALITY</code>, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u043a \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0443 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0435\u0449\u0451 \u043e\u0434\u0438\u043d \u0441\u0442\u043e\u043b\u0431\u0435\u0446 \u0441 \u0442\u0438\u043f\u043e\u043c <code>bigint</code>. \u0412 \u044d\u0442\u043e\u043c \u0441\u0442\u043e\u043b\u0431\u0446\u0435 \u043d\u0443\u043c\u0435\u0440\u0443\u044e\u0442\u0441\u044f \u0441\u0442\u0440\u043e\u043a\u0438 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0438\u0440\u0443\u044e\u0449\u0435\u0433\u043e \u043d\u0430\u0431\u043e\u0440\u0430, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 1. \u0422\u0430\u043a \u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043e\u043a\u043e\u043d\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441</p> <pre><code>SELECT   (xpath('/collaborator/lastname/text()', CL.data))[1]::TEXT\n        ,(xpath('/custom_elem/name/text()', CLD.cstm))[1]::TEXT AS name\n        ,(xpath('*/value/text()', CLD.cstm))[1]::TEXT AS value\n        ,CLD.idx AS node_number\n        ,ROW_NUMBER() OVER (PARTITION BY CL.id ORDER BY CL.id) AS node_number_wf\nFROM    dbo.collaborator CL\n        CROSS JOIN unnest(xpath('/collaborator/custom_elems/custom_elem', data)) with ordinality CLD(cstm, idx)\nWHERE   id = 6148914691236517121;\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_6","title":"\u0421\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u043f\u043e\u043b\u0435\u0439 \u0432 \u043e\u0434\u043d\u043e\u043c \u043f\u043e\u043b\u0435 \u043f\u043e \u043a\u043b\u044e\u0447\u0443","text":"<p>\u041f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u043c, \u0447\u0442\u043e \u0443 \u043d\u0430\u0441 \u0435\u0441\u0442\u044c \u0442\u0430\u0431\u043b\u0438\u0446\u0430, \u0433\u0434\u0435 \u043d\u0430 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u043d\u043e\u043c\u0435\u0440\u0430 \u0435\u0433\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043e\u0432</p> <p>\u0414\u0430\u043d\u043d\u044b\u0435:</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>SELECT   code\n        ,STRING_AGG(phone_number, ', ')\nFROM    phones\nGROUP BY code\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442: </p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_7","title":"\u041f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u043d\u043e\u0439 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439","text":"<p>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442:</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>WITH RECURSIVE tree (id, name, arr, level) AS \n(\n    SELECT   id\n            ,name\n            ,ARRAY[name::TEXT]\n            ,0 AS level\n    FROM    dbo.subdivisions\n    WHERE   parent_object_id IS NULL\n\n    UNION ALL\n\n    SELECT   S.id\n            ,S.name\n            ,array_append(arr, S.name::TEXT)\n            ,level + 1\n    FROM    tree T INNER JOIN dbo.subdivisions S ON T.id = S.parent_object_id\n)\n\nSELECT   id\n        ,array_to_string(arr, ' &gt;&gt; ') AS path\n        ,arr[1] AS top_level\n        ,arr[array_length(arr, 1)] AS bottom_level -- \"1\" - \u0447\u0438\u0441\u043b\u043e, \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u0435 \u043d\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u0435, \u0434\u043b\u044f \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u043d\u0443\u0436\u043d\u043e \u043d\u0430\u0439\u0442\u0438 \u0434\u043b\u0438\u043d\u0443. \u0414\u043b\u044f \u043e\u0434\u043d\u043e\u043c\u0435\u0440\u043d\u043e\u0433\u043e \u043c\u0430\u0441\u0441\u0438\u0432\u0430 \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044b\u0447\u043d\u043e \u0440\u0430\u0432\u043d\u043e 1\n        ,level\nFROM    tree\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#_8","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0439 \u043f\u043e \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0432\u0432\u0435\u0440\u0445, \u0432\u043a\u043b\u044e\u0447\u0430\u044f \u0441\u0430\u043c\u043e \u043f\u043e\u0434\u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u0435","text":"<p>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442:</p> <p></p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>WITH RECURSIVE tree AS (\n    SELECT  id, name, parent_object_id, 1 AS level\n    FROM    dbo.subdivisions\n    WHERE   id = 7060462602275304338\n\n    UNION ALL\n\n    SELECT  S.id, S.name, S.parent_object_id, level + 1\n    FROM    dbo.subdivisions S INNER JOIN tree T ON S.id = T.parent_object_id\n)\n\nSELECT  *\n        ,(string_to_array(reverse(array_to_string((SELECT array_agg(level) FROM tree), ',')), ','))[level]::INTEGER AS level_reverse\n        ,(array_length((SELECT array_agg(level) FROM tree), 1) - level + 1) AS level_reverse\nFROM    tree\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:</p> <p></p>"},{"location":"materials/postgres-xml-tutorial/#xml_13","title":"\u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f XML \u0443\u0437\u043b\u043e\u0432 \u0438 \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u043c \u0432 \u0441\u0442\u0440\u043e\u043a\u0443 \u0447\u0435\u0440\u0435\u0437 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044c","text":"<p>\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442</p> <p>\u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0432 \u0430\u0434\u043c\u0438\u043d\u043a\u0435</p> \u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0432 \u0430\u0434\u043c\u0438\u043d\u043a\u0435\u041a\u0430\u0441\u0442\u043e\u043c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f \u0432 XML <p></p> <pre><code>&lt;custom_elems&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_javascript&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_PHP&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_Docker&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_Kerberos&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_HTML&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n    &lt;custom_elem&gt;\n        &lt;name&gt;skill_WebTutor&lt;/name&gt;\n        &lt;value&gt;true&lt;/value&gt;\n    &lt;/custom_elem&gt;\n&lt;/custom_elems&gt;\n</code></pre> <p>\u041d\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430 - \u0441\u043e\u0431\u0440\u0430\u0442\u044c \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u0441\u043a\u0438\u043b\u043b\u044b.</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>SELECT   CLS.fullname\n        ,array_to_string(\n            xpath('/collaborator/custom_elems/custom_elem[contains(.,\"skill_\") and value = true()]/name/text()', CL.data)::TEXT[],\n            ', '\n        )\nFROM    dbo.collaborators CLS\n        INNER JOIN dbo.collaborator CL ON CLS.id = CL.id\nWHERE   xpath_exists('/collaborator/custom_elems/custom_elem[contains(.,\"skill_\") and value = true()]/name/text()', CL.data)\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p> <p>\u0415\u0441\u043b\u0438 \u0445\u043e\u0442\u0438\u043c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043f\u043e\u043b\u0435\u0439, \u0430 \u0438\u0445 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441:</p> <pre><code>WITH custom_template AS (\n    SELECT   (xpath('/field/name/text()', fld))[1]::TEXT AS name\n            ,(xpath('/field/title/text()', fld))[1]::TEXT AS title\n    from    dbo.\"(spxml_blobs)\"\n            CROSS JOIN unnest(xpath('/custom_templates/collaborator/fields/field', convert_from(data, 'UTF-8')::XML)) fld\n    where   url = 'x-local://wt_data/lists/wtv_custom_templates.xml'\n)\n,skills AS (\n    SELECT   CLS.fullname\n            ,CLS.id\n            ,unnest(\n                xpath('/collaborator/custom_elems/custom_elem[contains(.,\"skill_\") and value = true()]/name/text()', CL.data)::TEXT[]\n            ) AS skill\n    FROM    dbo.collaborators CLS\n            INNER JOIN dbo.collaborator CL ON CLS.id = CL.id\n    WHERE   xpath_exists('/collaborator/custom_elems/custom_elem[contains(.,\"skill_\") and value = true()]/name/text()', CL.data)\n)\n\nSELECT   S.fullname\n        ,string_agg(C.title, ', ')\nFROM    skills S INNER JOIN custom_template C ON S.skill = C.name\nGROUP BY S.id, S.fullname\n</code></pre> <p>\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442</p> <p></p>"},{"location":"materials/xquery-to-sql/","title":"\u041a\u0430\u043a XQuery \u043f\u0440\u0435\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0432 SQL","text":""},{"location":"materials/xquery-to-sql/#_1","title":"\u0412\u0432\u0435\u0434\u0435\u043d\u0438\u0435","text":"<p>\u0414\u043b\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u0440\u043e\u0431\u043e\u0447\u043d\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>XQuery</code> \u0438\u043b\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>tools.xquery</code></p> <p>\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u0445 \u0431\u0443\u0434\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0444\u0443\u043d\u043a\u0446\u0438\u044e <code>tools.xquery</code></p> <p>\u0412\u0441\u044e \u043e\u0441\u043d\u043e\u0432\u043d\u0443\u044e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0430\u043c <code>XQuery</code> \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0439\u0442\u0438 \u043d\u0430 \u043f\u043e\u0440\u0442\u0430\u043b\u0435 WebSoft \u043f\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u0441\u0441\u044b\u043b\u043a\u0430\u043c:</p> <ul> <li>\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 XQuery</li> <li>\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 tools.xquery</li> <li>\u0412\u0438\u0434\u0435\u043e \u0441 \u0431\u0430\u0437\u043e\u0432\u044b\u043c \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435\u043c</li> <li>\u0421\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441 XQuery \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432</li> <li>\u0417\u0430\u043f\u0440\u043e\u0441\u044b XQuery</li> </ul> <p>\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u0445 \u0432 \u0431\u043b\u043e\u043a\u0435 <code>XQuery</code> \u0443\u043a\u0430\u0437\u0430\u043d \u0437\u0430\u043f\u0440\u043e\u0441 XQuery, \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u044e\u0449\u0438\u0439\u0441\u044f \u0447\u0435\u0440\u0435\u0437 <code>tools.xquery</code></p> <p>\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u0445 \u0432 \u0431\u043b\u043e\u043a\u0435 <code>SQL</code> \u0443\u043a\u0430\u0437\u0430\u043d \u0437\u0430\u043f\u0440\u043e\u0441 SQL, \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0442\u0440\u0430\u043d\u0441\u043f\u0438\u043b\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043f\u0440\u043e\u0441 <code>XQuery</code> \u044f\u0434\u0440\u043e\u043c \u0441\u0438\u0441\u0442\u0435\u043c\u044b WebSoft</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p><code>LuceneFTIndex</code> \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d, \u0435\u0441\u043b\u0438 \u0438\u043d\u0434\u0435\u043a\u0441 \u0432\u043a\u043b\u044e\u0447\u0435\u043d, \u0442\u043e \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u044b SQL \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0438\u043d\u0430\u0447\u0435, \u0432 \u0437\u0430\u043f\u0440\u043e\u0441 \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0441\u0440\u0430\u0437\u0443 \u0418\u0414 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432</p>"},{"location":"materials/xquery-to-sql/#_2","title":"\u0417\u0430\u043f\u0440\u043e\u0441\u044b","text":""},{"location":"materials/xquery-to-sql/#_3","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nreturn \n    $elem/id, $elem/fullname, $elem/position_name \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    id = 1105387902724063494 \nreturn \n    $elem/id, $elem/fullname, $elem/position_name \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_elem.[position_name] \nfrom    dbo.[collaborators] t_elem \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"position_name\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   \"id\"=1105387902724063494 \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#fieldsfield1-field2","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 Fields(field1, field2)","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nreturn \n    $elem/Fields(id, fullname) \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    id = 1105387902724063494 \nreturn \n    $elem/Fields(id, fullname) \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   \"id\"=1105387902724063494 \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#fieldsfield1-field2_1","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 Fields('field1', 'field2')","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nreturn \n    $elem/Fields('id', 'fullname', 'org_name') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    id = 1105387902724063494 \nreturn \n    $elem/Fields('id', 'fullname', 'org_name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_elem.[org_name] \nfrom    dbo.[collaborators] t_elem \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"org_name\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   \"id\"=1105387902724063494 \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#_4","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0438\u0437 \u043e\u0434\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/Fields('id', 'position_name'), $elem/fullname \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/Fields('id', 'position_name'), $elem/fullname \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[position_name], \n        t_elem.[fullname] \nfrom    dbo.[positions] t_pos, dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"position_name\", \n        t_elem.\"fullname\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#_5","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0442\u0430\u0431\u043b\u0438\u0446","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 2 \u043f\u043e\u043b\u044f \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u0438\u043c\u0435\u043d\u0435\u043c \u0438\u0437 \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 - \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u043f\u0430\u0434\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>return $elem/id, $pos/id</code> \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u043e\u043b\u044c\u043a\u043e 1 \u043f\u043e\u043b\u0435 <code>id</code></p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/id, $elem/fullname, $pos/name \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/id, $elem/fullname, $pos/name \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_pos.[name] \nfrom    dbo.[positions] t_pos, dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_pos.\"name\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \n</code></pre>"},{"location":"materials/xquery-to-sql/#fields","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 \u0447\u0435\u0440\u0435\u0437 Fields()","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0412 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code> \u043c\u0435\u0436\u0434\u0443 <code>Fields</code> \u043d\u0435\u0442 \u0437\u0430\u043f\u044f\u0442\u043e\u0439. \u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u044f\u0442\u0443\u044e, \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043a\u0438\u0434\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/Fields(id, fullname) $pos/Fields(name) \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/Fields(id, fullname, org_name) $pos/Fields(name) \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_pos.[name] \nfrom    dbo.[positions] t_pos, \n        dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"org_name\", \n        t_pos.\"name\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \n</code></pre>"},{"location":"materials/xquery-to-sql/#fields_1","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u0432\u044b\u0432\u043e\u0434\u043e\u043c \u043f\u043e\u043b\u0435\u0439 \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 \u0447\u0435\u0440\u0435\u0437 Fields('')","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0412 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code> \u043c\u0435\u0436\u0434\u0443 <code>Fields</code> \u043d\u0435\u0442 \u0437\u0430\u043f\u044f\u0442\u043e\u0439. \u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u044f\u0442\u0443\u044e, \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043a\u0438\u0434\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/Fields('id', 'fullname') $pos/Fields('name') \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/Fields('id', 'fullname') $pos/Fields('name', 'code') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_pos.[name] \nfrom    dbo.[positions] t_pos, dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_pos.\"name\", \n        t_pos.\"code\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \n</code></pre>"},{"location":"materials/xquery-to-sql/#_6","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043f\u043e\u043b\u0435\u0439","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 2 \u043f\u043e\u043b\u044f \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u0438\u043c\u0435\u043d\u0435\u043c \u0438\u0437 \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 - \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u043f\u0430\u0434\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>return $elem/id, $pos/id</code> \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u043e\u043b\u044c\u043a\u043e 1 \u043f\u043e\u043b\u0435 <code>id</code></p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/id uid, $elem/fullname full_name, $pos/name position_name \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/id uid, $elem/fullname full_name, $pos/name position_name \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id] [uid], \n        t_elem.[fullname] [full_name], \n        t_pos.[name] [position_name] \nfrom    dbo.[positions] t_pos, dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\" \"uid\", \n        t_elem.\"fullname\" \"full_name\", \n        t_pos.\"name\" \"position_name\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \n</code></pre>"},{"location":"materials/xquery-to-sql/#fields_2","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0441 \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u043f\u043e\u043b\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 Fields()","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u0432\u044b\u0432\u0435\u0441\u0442\u0438 2 \u043f\u043e\u043b\u044f \u0441 \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u043c \u0438\u043c\u0435\u043d\u0435\u043c \u0438\u0437 \u0440\u0430\u0437\u043d\u044b\u0445 \u0442\u0430\u0431\u043b\u0438\u0446 - \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u043f\u0430\u0434\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>return $elem/id, $pos/id</code> \u0432\u044b\u0432\u0435\u0434\u0435\u0442 \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0442\u043e\u043b\u044c\u043a\u043e 1 \u043f\u043e\u043b\u0435 <code>id</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0412 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code> \u043c\u0435\u0436\u0434\u0443 <code>Fields</code> \u043d\u0435\u0442 \u0437\u0430\u043f\u044f\u0442\u043e\u0439. \u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u044f\u0442\u0443\u044e, \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043a\u0438\u0434\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id \nreturn \n    $elem/Fields(id uid, fullname full_name) $pos/Fields(name position_name) \n</code></pre> <pre><code>for \n    $elem in collaborators, \n    $pos in positions \nwhere \n    $elem/position_id = $pos/id and \n    $elem/id = 1105387902724063494 \nreturn \n    $elem/Fields(id uid, fullname full_name) $pos/Fields(name position_name) \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id] [uid], \n        t_elem.[fullname] [full_name], \n        t_pos.[name] [position_name] \nfrom    dbo.[positions] t_pos, dbo.[collaborators] t_elem \nwhere   t_elem.[position_id] = t_pos.[id] \n</code></pre> <pre><code>select  t_elem.\"id\" \"uid\", \n        t_elem.\"fullname\" \"full_name\", \n        t_pos.\"name\" \"position_name\" \nfrom    dbo.\"positions\" t_pos, \n        dbo.\"collaborators\" t_elem \nwhere   t_elem.\"position_id\"= t_pos.\"id\" \n    and t_elem.\"id\"=1105387902724063494 \n</code></pre>"},{"location":"materials/xquery-to-sql/#somesatisfies","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0447\u0435\u0440\u0435\u0437 some/satisfies","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 <code>some/satisfies</code> \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u043b\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 <code>$elem</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0432 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u043f\u043e\u0441\u043b\u0435 <code>satisfies</code> <code>($elem/position_id = $pos/id)</code> \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0432 <code>ON</code> \u043a <code>INNER JOIN</code>, \u0432\u0441\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u043f\u043e\u0441\u043b\u0435 \u0441\u043a\u043e\u0431\u043e\u043a \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0432 <code>WHERE</code></p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    some $pos in positions satisfies ($elem/position_id = $pos/id) and \n    $pos/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/id \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430</p> <pre><code>for \n    $elem in collaborators \nwhere \n    some $pos in positions satisfies ($elem/position_id = $pos/id) and \n    $pos/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/id \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n        select  t_elem.[id] \n        from    dbo.[collaborators] t_elem \n            inner join dbo.[positions] t_pos ON t_elem.[position_id] = t_pos.[id] \n        where t_pos.[name] ='\u0422\u0440\u0435\u043d\u0435\u0440' \n    ) \n</code></pre> <pre><code>select  t_elem.\"id\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  t_elem.\"id\" \n            from    dbo.\"collaborators\" t_elem \n                    inner join dbo.\"positions\" t_pos ON t_elem.\"position_id\"= t_pos.\"id\" \n            where t_pos.\"name\"='\u0422\u0440\u0435\u043d\u0435\u0440' \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#somesatisfies_1","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u0442\u0440\u0451\u043c \u0438 \u0431\u043e\u043b\u0435\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0447\u0435\u0440\u0435\u0437 some/satisfies","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 <code>some/satisfies</code> \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u043b\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 \u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0433\u043e \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430 <code>$elem</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0423\u0441\u043b\u043e\u0432\u0438\u044f \u0432 \u0441\u043a\u043e\u0431\u043a\u0430\u0445 \u043f\u043e\u0441\u043b\u0435 <code>satisfies</code> <code>($elem/position_id = $pos/id)</code> \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0432 <code>ON</code> \u043a <code>INNER JOIN</code>, \u0432\u0441\u0435 \u0443\u0441\u043b\u043e\u0432\u0438\u044f \u043f\u043e\u0441\u043b\u0435 \u0441\u043a\u043e\u0431\u043e\u043a \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u043d\u0435\u0441\u0435\u043d\u044b \u0432 <code>WHERE</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043e\u043a <code>some/satisfies</code> \u0432 <code>XQuery</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043e\u043d\u0438 \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0441\u043e\u0431\u0440\u0430\u043d\u044b \u0432 <code>SQL</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435. \u0415\u0441\u043b\u0438 \u043f\u043e\u043c\u0435\u043d\u044f\u0435\u043c \u0441\u0442\u0440\u043e\u043a\u0438 \u043c\u0435\u0441\u0442\u0430\u043c\u0438, \u0442\u043e \u043f\u043e\u043b\u0443\u0447\u0438\u043c \u043e\u0448\u0438\u0431\u043a\u0443 \u0432 SQL \u0437\u0430\u043f\u0440\u043e\u0441\u0435</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    some $app in appointment_types satisfies ($pos/position_appointment_type_id = $app/id) and \n    some $pos in positions satisfies ($elem/position_id = $pos/id) and \n    $pos/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/Fields('id', 'position_name') \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430</p> <pre><code>for \n    $elem in collaborators \nwhere \n    some $app in appointment_types satisfies ($pos/position_appointment_type_id = $app/id) and \n    some $pos in positions satisfies ($elem/position_id = $pos/id) and \n    $pos/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/Fields('id', 'position_name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[position_name] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n            select  t_elem.[id] \n            from    dbo.[collaborators] t_elem \n                inner join dbo.[positions] t_pos ON t_elem.[position_id] = t_pos.[id] \n                inner join dbo.[appointment_types] t_app ON t_pos.[position_appointment_type_id] = t_app.[id] \n            where t_pos.[name] = '\u0422\u0440\u0435\u043d\u0435\u0440' \n        ) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"position_name\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  t_elem.\"id\" \n            from    dbo.\"collaborators\" t_elem \n                    inner join dbo.\"positions\" t_pos ON t_elem.\"position_id\"= t_pos.\"id\" \n                    inner join dbo.\"appointment_types\" t_app ON t_pos.\"position_appointment_type_id\"= t_app.\"id\" \n            where   t_pos.\"name\"='\u0422\u0440\u0435\u043d\u0435\u0440' \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#contains","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u0447\u0435\u0440\u0435\u0437 contains","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    contains($elem/fullname, '\u043e\u0441\u043a\u0438\u043d') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    contains($elem/fullname, '\u0442\u0438\u0445\u043e\u043c\u0438\u0440\u043e\u0432') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n    t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   (t_elem.[fullname] like '%\u043e\u0441\u043a\u0438\u043d%') \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   ( \n            t_elem.\"fullname\" ilike '%\u0442\u0438\u0445\u043e\u043c\u0438\u0440\u043e\u0432%' \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#doc-contains","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u0447\u0435\u0440\u0435\u0437 doc-contains","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u043e\u0438\u0441\u043a \u0447\u0435\u0440\u0435\u0437 <code>doc-contains</code> \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043b\u043e\u0432\u0430, \u0442\u043e \u0435\u0441\u0442\u044c, \u0435\u0441\u043b\u0438 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0432 \u043f\u043e\u043b\u0435 <code>position_name</code> \u0431\u0443\u0434\u0435\u0442 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u043e\u0441\u0442\u044c <code>\u0422\u0440\u0435\u043d\u0435\u0440</code>, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0442\u0440\u0435\u043d</code> \u043d\u0430\u0439\u0434\u0435\u0442 \u0432\u0441\u0435\u0445 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0440\u0435\u043d\u0435\u0440</code> \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u0442 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432</p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '\u0417\u0430\u0433\u043e\u0441') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '\u0442\u0438\u0445\u043e\u043c\u0438') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n    t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n        select  [id] \n        from    dbo.[collaborator] \n        where   contains(*,'\"\u0417\u0430\u0433\u043e\u0441*\"') \n    ) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  \"id\" \n            from    dbo.\"collaborator\" \n            where   xmlexists('/collaborator/*[contains(text(),\"\u0421\u0438\u0434\")]' passing by ref \"data\") = true \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#doc-contains_1","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u043f\u043e \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u043c\u0443 \u043f\u043e\u043b\u044e \u0447\u0435\u0440\u0435\u0437 doc-contains","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0431\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043a\u0430\u0432\u044b\u0447\u043a\u0438, \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u0432 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>SQL</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u043e\u0438\u0441\u043a \u0447\u0435\u0440\u0435\u0437 <code>doc-contains</code> \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043b\u043e\u0432\u0430, \u0442\u043e \u0435\u0441\u0442\u044c, \u0435\u0441\u043b\u0438 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0432 \u043f\u043e\u043b\u0435 <code>position_name</code> \u0431\u0443\u0434\u0435\u0442 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u043e\u0441\u0442\u044c <code>\u0422\u0440\u0435\u043d\u0435\u0440</code>, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0442\u0440\u0435\u043d</code> \u043d\u0430\u0439\u0434\u0435\u0442 \u0432\u0441\u0435\u0445 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0440\u0435\u043d\u0435\u0440</code> \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u0442 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[test = \u043e\u043b\u043e\u043b\u043e\u043b\u043e]') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430</p> <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[fld_city = \u0421\u0438\u0434\u043d\u0435\u0439]') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n            select  [id] \n            from    dbo.[collaborator] \n            where   data.exist('collaborator/custom_elems/custom_elem[name = \"test\" and value[1] = \"\u043e\u043b\u043e\u043b\u043e\u043b\u043e\"]') = 1 \n        ) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  \"id\" \n            from    dbo.\"collaborator\" \n            where   XMLExists('/collaborator/custom_elems/custom_elem[name = \"fld_city\" and value = \"\u0421\u0438\u0434\u043d\u0435\u0439\"]' PASSING by ref \"data\") \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#doc-contains-contains","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u043f\u043e \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u043c\u0443 \u043f\u043e\u043b\u044e \u0447\u0435\u0440\u0435\u0437 doc-contains \u0438 contains \u043f\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044e","text":"<p>XQuery</p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043e\u0431\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u044e\u0442\u0441\u044f \u0432 \u043a\u0430\u0432\u044b\u0447\u043a\u0438, \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0431\u043b\u044e\u0434\u0430\u0442\u044c \u0432 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>SQL</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u043e\u0438\u0441\u043a \u0447\u0435\u0440\u0435\u0437 <code>doc-contains</code> \u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u0441\u044f \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u043b\u043e\u0432\u0430, \u0442\u043e \u0435\u0441\u0442\u044c, \u0435\u0441\u043b\u0438 \u0432 \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0435 \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430 \u0432 \u043f\u043e\u043b\u0435 <code>position_name</code> \u0431\u0443\u0434\u0435\u0442 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0434\u043e\u043b\u0436\u043d\u043e\u0441\u0442\u044c <code>\u0422\u0440\u0435\u043d\u0435\u0440</code>, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0442\u0440\u0435\u043d</code> \u043d\u0430\u0439\u0434\u0435\u0442 \u0432\u0441\u0435\u0445 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432, \u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0444\u0440\u0430\u0437\u0435 <code>\u0440\u0435\u043d\u0435\u0440</code> \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u0442 \u0442\u0440\u0435\u043d\u0435\u0440\u043e\u0432</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[test contains \u043b\u043e]') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430</p> <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[fld_city contains \u0421\u0438\u0434]') \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n        select  [id] \n        from    dbo.[collaborator] \n        where   data.exist('collaborator/custom_elems/custom_elem[name = \"test\" and contains(value[1], \"\u043b\u043e\")]') = 1 \n    ) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  \"id\" \n            from    dbo.\"collaborator\" \n            where   XMLExists('/collaborator/custom_elems/custom_elem[name = \"fld_city\" and contains(value,  \"\u0421\u0438\u0434\")]' PASSING by ref \"data\") \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#doc-contains_2","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u043f\u043e \u043a\u0430\u0441\u0442\u043e\u043c\u043d\u043e\u043c\u0443 \u043f\u043e\u043b\u044e \u0447\u0435\u0440\u0435\u0437 doc-contains \u0441 \u043f\u0440\u0438\u0432\u0435\u0434\u0435\u043d\u0438\u0435\u043c \u0442\u0438\u043f\u043e\u0432","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[b_test = true~bool]') \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    doc-contains($elem/id, '', '[fld_married = true~bool]') \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[fullname], \n        t_elem.[position_name] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[id] in ( \n        select  [id] \n        from    dbo.[collaborator] \n        where   data.exist('collaborator/custom_elems/custom_elem[name = \"b_test\" and xs:boolean(value[1]) = true()]') = 1 \n    ) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"position_name\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"id\" in ( \n            select  \"id\" \n            from    dbo.\"collaborator\" \n            where   XMLExists('/collaborator/custom_elems/custom_elem[name = \"fld_married\" and value = \"true\"]' PASSING by ref \"data\") \n        ) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#foreignelem","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c ForeignElem","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    ForeignElem($elem/position_id)/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0417\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441 \u0443\u0447\u0451\u0442\u043e\u043c \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430</p> <pre><code>for \n    $elem in collaborators \nwhere \n    ForeignElem($elem/position_id)/name = '\u0422\u0440\u0435\u043d\u0435\u0440' \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n    t_elem.[fullname], \n    t_elem.[position_name] \nfrom    dbo.[collaborators] t_elem \n    inner join dbo.[positions] [f-1783245827] on t_elem.[position_id] = [f-1783245827].[id] \nwhere   [f-1783245827].[name] = '\u0422\u0440\u0435\u043d\u0435\u0440' \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"position_name\" \nfrom    dbo.\"collaborators\" t_elem \n        left join dbo.\"positions\" \"f1486165897\" on t_elem.\"position_id\" = \"f1486165897\".\"id\" \nwhere   \"f1486165897\".\"name\"='\u0422\u0440\u0435\u043d\u0435\u0440' \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#true-false-null","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c true(), false(), null(), ''","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    $elem/is_dismiss = false() or \n    $elem/is_dismiss != false() or \n    $elem/is_dismiss = true() or \n    $elem/is_dismiss != true() or \n    $elem/is_dismiss = null() or \n    $elem/is_dismiss != null() or \n    $elem/is_dismiss = '' or \n    $elem/is_dismiss != '' \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    $elem/is_dismiss = false() or \n    $elem/is_dismiss != false() or \n    $elem/is_dismiss = true() or \n    $elem/is_dismiss != true() or \n    $elem/is_dismiss = null() or \n    $elem/is_dismiss != null() or \n    $elem/is_dismiss = '' or \n    $elem/is_dismiss != '' \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   (t_elem.[is_dismiss] = 0 OR t_elem.[is_dismiss] IS NULL) or -- $elem/is_dismiss = false() \n    t_elem.[is_dismiss] &lt;&gt; 0 or -- $elem/is_dismiss != false() \n    t_elem.[is_dismiss] = 1 or -- $elem/is_dismiss = true() \n    (t_elem.[is_dismiss] &lt;&gt; 1 OR t_elem.[is_dismiss] IS NULL) or -- $elem/is_dismiss != true() \n    t_elem.[is_dismiss] IS NULL or -- $elem/is_dismiss = null() \n    t_elem.[is_dismiss] IS NOT NULL or -- $elem/is_dismiss != null() \n    t_elem.[is_dismiss] IS NULL or -- $elem/is_dismiss = '' \n    t_elem.[is_dismiss] IS NOT NULL -- $elem/is_dismiss != '' \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   ((t_elem.\"is_dismiss\"=false) OR ((t_elem.\"is_dismiss\") IS NULL)) \n    or  t_elem.\"is_dismiss\"&lt;&gt;false \n    or  t_elem.\"is_dismiss\"=true \n    or  ((t_elem.\"is_dismiss\"&lt;&gt;true) OR ((t_elem.\"is_dismiss\") IS NULL)) \n    or  t_elem.\"is_dismiss\" IS NULL \n    or  t_elem.\"is_dismiss\" IS NOT NULL \n    or  t_elem.\"is_dismiss\" IS NULL \n    or  t_elem.\"is_dismiss\" IS NOT NULL \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#date","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c date()","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    $elem/hire_date = date('2010-03-17') \nreturn \n    $elem/Fields('id', 'fullname', 'hire_date') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    $elem/hire_date = date('2010-03-17') \nreturn \n    $elem/Fields('id', 'fullname', 'hire_date') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>SET DATEFORMAT dmy; \nselect  t_elem.[id], t_elem.[fullname], t_elem.[hire_date] \nfrom    dbo.[collaborators] t_elem \nwhere   t_elem.[hire_date] = '17.03.2010 0:00:00' \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"hire_date\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   t_elem.\"hire_date\"='2010-03-17 00:00:00' \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#ishierchild","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c IsHierChild()","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0435\u0440\u0435\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439 <code>IsHierChild</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0442\u043e\u044f\u0442\u044c \u043f\u0440\u043e\u0431\u0435\u043b, \u0437\u043d\u0430\u043a \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u0438 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043e\u0448\u0438\u0431\u043a\u0435 </p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0447\u0435\u0440\u0435\u0437 <code>XQuery</code></p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in subdivisions \nwhere \n    IsHierChild($elem/id, 6327975429225669221) \norder by \n    $elem/Hier() \nreturn \n    $elem/id \n</code></pre> <pre><code>for \n    $elem in subdivisions \nwhere \n    IsHierChild($elem/id, 6327975429225669221) \norder by \n    $elem/Hier() \nreturn \n    $elem/id , $elem/name\n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>WITH [subdivisions_cte] ( \n    [id], \n    [code], \n    [name], \n    [org_id], \n    [parent_object_id], \n    [is_disbanded], \n    [knowledge_parts], \n    [tags], \n    [experts], \n    [place_id], \n    [region_id], \n    [kpi_profile_id], \n    [bonus_profile_id], \n    [cost_center_id], \n    [is_faculty], \n    [modification_date], \n    [app_instance_id], \n    [kpi_profiles_id], \n    [__hlevel], \n    [__sort_level], \n    [__hcc] \n) AS ( \n    SELECT  [id], \n            [code], \n            [name], \n            [org_id], \n            [parent_object_id], \n            [is_disbanded], \n            [knowledge_parts], \n            [tags], \n            [experts], \n            [place_id], \n            [region_id], \n            [kpi_profile_id], \n            [bonus_profile_id], \n            [cost_center_id], \n            [is_faculty], \n            [modification_date], \n            [app_instance_id], \n            [kpi_profiles_id], \n            0 as [__hlevel], \n            cast((CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n        (select top 1 1 from dbo.[subdivisions] f where f.parent_object_id = e.id) as [__hcc] \n    FROM    dbo.[subdivisions] e \n    WHERE   e.parent_object_id = 6327975429225669221 \n    UNION ALL \n    SELECT  e.[id], \n            e.[code], \n            e.[name], \n            e.[org_id], \n            e.[parent_object_id], \n            e.[is_disbanded], \n            e.[knowledge_parts], \n            e.[tags], \n            e.[experts], \n            e.[place_id], \n            e.[region_id], \n            e.[kpi_profile_id], \n            e.[bonus_profile_id], \n            e.[cost_center_id], \n            e.[is_faculty], \n            e.[modification_date], \n            e.[app_instance_id], \n            e.[kpi_profiles_id], \n            [__hlevel] + 1, \n            cast((d.[__sort_level] + '.' + CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n            (select 1 WHERE EXISTS (SELECT id FROM dbo.[subdivisions] f WHERE e.id = f.parent_object_id)) as [__hcc] \n    FROM    dbo.[subdivisions] e \n        INNER JOIN [subdivisions_cte] d ON e.parent_object_id = d.id \n) \n\nselect  t_elem.[id],\n        [__hcc],\n        [__hlevel] \nfrom    [subdivisions_cte] t_elem \norder by t_elem.[__sort_level] asc\n</code></pre> <pre><code>WITH RECURSIVE \"subdivisions_cte\" ( \n    \"id\", \n    \"code\", \n    \"name\", \n    \"org_id\", \n    \"parent_object_id\", \n    \"is_disbanded\", \n    \"knowledge_parts\", \n    \"tags\", \n    \"experts\", \n    \"place_id\", \n    \"region_id\", \n    \"kpi_profile_id\", \n    \"kpi_profiles_id\", \n    \"bonus_profile_id\", \n    \"cost_center_id\", \n    \"is_faculty\", \n    \"modification_date\", \n    \"app_instance_id\", \n    \"__hlevel\", \n    \"__sort_level\", \n    \"__hcc\" \n) AS (\n    SELECT  \"id\", \n            \"code\", \n            \"name\", \n            \"org_id\", \n            \"parent_object_id\", \n            \"is_disbanded\", \n            \"knowledge_parts\", \n            \"tags\",\"experts\", \n            \"place_id\", \n            \"region_id\", \n            \"kpi_profile_id\", \n            \"kpi_profiles_id\", \n            \"bonus_profile_id\", \n            \"cost_center_id\", \n            \"is_faculty\", \n            \"modification_date\", \n            \"app_instance_id\", \n            0 as __hlevel, \n            cast((CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n            (select 1 from dbo.\"subdivisions\" f where f.parent_object_id = e.id limit 1) as \"__hcc\" \n    FROM    dbo.\"subdivisions\" e \n    WHERE   e.parent_object_id = '6327975429225669221' \n    UNION ALL \n    SELECT  e.\"id\", \n            e.\"code\", \n            e.\"name\", \n            e.\"org_id\", \n            e.\"parent_object_id\", \n            e.\"is_disbanded\", \n            e.\"knowledge_parts\", \n            e.\"tags\", \n            e.\"experts\", \n            e.\"place_id\", \n            e.\"region_id\", \n            e.\"kpi_profile_id\", \n            e.\"kpi_profiles_id\", \n            e.\"bonus_profile_id\", \n            e.\"cost_center_id\", \n            e.\"is_faculty\", \n            e.\"modification_date\", \n            e.\"app_instance_id\",\"__hlevel\"+1, \n            cast((d.\"__sort_level\"||'.'||CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n            (select 1 WHERE EXISTS (SELECT id FROM dbo.\"subdivisions\" f WHERE e.id = f.parent_object_id)) as \"__hcc\" \n    FROM    dbo.\"subdivisions\" e \n            INNER JOIN \"subdivisions_cte\" d ON e.parent_object_id = d.id \n) \n\nselect  t_elem.\"id\", \n        t_elem.\"name\", \n        \"__hcc\", \n        \"__hlevel\" \nfrom    \"subdivisions_cte\" t_elem \norder by t_elem.\"__sort_level\" asc nulls first \n</code></pre>"},{"location":"materials/xquery-to-sql/#ishierchildorself","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u0438 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c IsHierChildOrSelf()","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041f\u0435\u0440\u0435\u0434 \u0444\u0443\u043d\u043a\u0446\u0438\u0435\u0439 <code>IsHierChild</code> \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0442\u043e\u044f\u0442\u044c \u043f\u0440\u043e\u0431\u0435\u043b, \u0437\u043d\u0430\u043a \u0442\u0430\u0431\u0443\u043b\u044f\u0446\u0438\u0438 \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043e\u0448\u0438\u0431\u043a\u0435 </p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041d\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0447\u0435\u0440\u0435\u0437 <code>XQuery</code></p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in subdivisions \nwhere \n    IsHierChildOrSelf($elem/id, 6327975429225669221) and \n    $elem/is_disbanded = false() \norder by \n    $elem/Hier() \nreturn \n    $elem/id, $elem/name \n</code></pre> <pre><code>for \n    $elem in subdivisions \nwhere \n    IsHierChildOrSelf($elem/id, 6327975429225669221) and \n    $elem/is_disbanded = false() \norder by \n    $elem/Hier() \nreturn \n    $elem/Fields(id, name) \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>WITH [subdivisions_cte] ( \n    [id], \n    [code], \n    [name], \n    [org_id], \n    [parent_object_id], \n    [is_disbanded], \n    [knowledge_parts], \n    [tags], \n    [experts], \n    [place_id], \n    [region_id], \n    [kpi_profile_id], \n    [bonus_profile_id], \n    [cost_center_id], \n    [is_faculty], \n    [modification_date], \n    [app_instance_id], \n    [kpi_profiles_id], \n    [__hlevel], \n    [__sort_level], \n    [__hcc] \n) AS ( \n    SELECT  [id], \n            [code], \n            [name], \n            [org_id], \n            [parent_object_id], \n            [is_disbanded], \n            [knowledge_parts], \n            [tags], \n            [experts], \n            [place_id], \n            [region_id], \n            [kpi_profile_id], \n            [bonus_profile_id], \n            [cost_center_id], \n            [is_faculty], \n            [modification_date], \n            [app_instance_id], \n            [kpi_profiles_id], \n            0 as [__hlevel], \n            cast((CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n            (select top 1 1 from dbo.[subdivisions] f where f.parent_object_id = e.id) as [__hcc] \n    FROM    dbo.[subdivisions] e \n    WHERE   e.id = 6327975429225669221 \n    UNION ALL \n    SELECT  e.[id], \n            e.[code], \n            e.[name], \n            e.[org_id], \n            e.[parent_object_id], \n            e.[is_disbanded], \n            e.[knowledge_parts], \n            e.[tags], \n            e.[experts], \n            e.[place_id], \n            e.[region_id], \n            e.[kpi_profile_id], \n            e.[bonus_profile_id], \n            e.[cost_center_id], \n            e.[is_faculty], \n            e.[modification_date], \n            e.[app_instance_id], \n            e.[kpi_profiles_id], \n            [__hlevel] + 1, \n            cast((d.[__sort_level] + '.' + CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n            (select 1 WHERE EXISTS (SELECT id FROM dbo.[subdivisions] f WHERE e.id = f.parent_object_id)) as [__hcc] \n    FROM    dbo.[subdivisions] e \n            INNER JOIN [subdivisions_cte] d ON e.parent_object_id = d.id \n) \n\nselect  t_elem.[id], \n        t_elem.[name], \n        [__hcc], \n        [__hlevel] \nfrom    [subdivisions_cte] t_elem \nwhere   (( t_elem.[is_disbanded] = 0) OR (( t_elem.[is_disbanded]) IS NULL)) \norder by t_elem.[__sort_level] asc \n</code></pre> <pre><code>WITH RECURSIVE \"subdivisions_cte\" ( \n    \"id\", \n    \"code\", \n    \"name\", \n    \"org_id\", \n    \"parent_object_id\", \n    \"is_disbanded\", \n    \"knowledge_parts\", \n    \"tags\", \n    \"experts\", \n    \"place_id\", \n    \"region_id\", \n    \"kpi_profile_id\", \n    \"kpi_profiles_id\", \n    \"bonus_profile_id\", \n    \"cost_center_id\", \n    \"is_faculty\", \n    \"modification_date\", \n    \"app_instance_id\", \n    \"__hlevel\", \n    \"__sort_level\",\"__hcc\" \n    ) AS ( \n        SELECT  \"id\", \n                \"code\", \n                \"name\", \n                \"org_id\", \n                \"parent_object_id\", \n                \"is_disbanded\", \n                \"knowledge_parts\", \n                \"tags\", \n                \"experts\", \n                \"place_id\", \n                \"region_id\", \n                \"kpi_profile_id\", \n                \"kpi_profiles_id\", \n                \"bonus_profile_id\", \n                \"cost_center_id\", \n                \"is_faculty\", \n                \"modification_date\", \n                \"app_instance_id\", \n                0 as __hlevel, \n                cast((CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n                (select 1 from dbo.\"subdivisions\" f where f.parent_object_id = e.id limit 1) as \"__hcc\" \n        FROM dbo.\"subdivisions\" e \n        WHERE e.id = '6327975429225669221' \n        UNION ALL \n        SELECT  e.\"id\", \n                e.\"code\", \n                e.\"name\", \n                e.\"org_id\", \n                e.\"parent_object_id\", \n                e.\"is_disbanded\", \n                e.\"knowledge_parts\", \n                e.\"tags\", \n                e.\"experts\", \n                e.\"place_id\", \n                e.\"region_id\", \n                e.\"kpi_profile_id\", \n                e.\"kpi_profiles_id\", \n                e.\"bonus_profile_id\", \n                e.\"cost_center_id\", \n                e.\"is_faculty\", \n                e.\"modification_date\", \n                e.\"app_instance_id\", \n                \"__hlevel\"+1, \n                cast((d.\"__sort_level\"||'.'||CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n                (select 1 WHERE EXISTS (SELECT id FROM dbo.\"subdivisions\" f WHERE e.id = f.parent_object_id)) as \"__hcc\" \n        FROM    dbo.\"subdivisions\" e \n                INNER JOIN \"subdivisions_cte\" d ON e.parent_object_id = d.id \n) \n\nselect  t_elem.\"id\", \n        t_elem.\"name\", \n        \"__hcc\", \n        \"__hlevel\" \nfrom    \"subdivisions_cte\" t_elem \nwhere   (( t_elem.\"is_disbanded\"=false) OR (( t_elem.\"is_disbanded\") IS NULL)) \norder by t_elem.\"__sort_level\" asc nulls first \n</code></pre>"},{"location":"materials/xquery-to-sql/#matchsome","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c MatchSome()","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    MatchSome($elem/code, ('13744', '386792', 'nothing')) \nreturn \n    $elem/Fields('id', 'code', 'fullname') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    MatchSome($elem/code, ('13744', '386792', 'nothing')) \nreturn \n    $elem/Fields('id', 'code', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], \n        t_elem.[code], \n        t_elem.[fullname] \nfrom    dbo.[collaborators] t_elem \nwhere   (t_elem.[code] in ('13744', '386792', 'nothing')) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"code\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   (t_elem.\"code\" in ('13744','386792','nothing')) \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#cataloghiersubset","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c CatalogHierSubset()","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>CatalogHierSubset('subdivisions', 6327975429225669221) \n</code></pre> <pre><code>CatalogHierSubset('subdivisions', 6327975429225669221) \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>WITH [subdivisions_cte] ( \n    [id], \n    [code], \n    [name], \n    [org_id], \n    [parent_object_id], \n    [is_disbanded], \n    [knowledge_parts], \n    [tags], \n    [experts], \n    [place_id], \n    [region_id], \n    [kpi_profile_id], \n    [bonus_profile_id], \n    [cost_center_id], \n    [is_faculty], \n    [modification_date], \n    [app_instance_id], \n    [kpi_profiles_id], \n    [__hlevel], \n    [__sort_level], \n    [__hcc] \n) AS ( \n    SELECT  [id], \n            [code], \n            [name], \n            [org_id], \n            [parent_object_id], \n            [is_disbanded], \n            [knowledge_parts], \n            [tags], \n            [experts], \n            [place_id], \n            [region_id], \n            [kpi_profile_id], \n            [bonus_profile_id], \n            [cost_center_id], \n            [is_faculty], \n            [modification_date], \n            [app_instance_id], \n            [kpi_profiles_id], \n            0 as [__hlevel],cast((CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n            (select top 1 1 from dbo.subdivisions f where f.parent_object_id = e.id) as [__hcc] \n    FROM    dbo.subdivisions e \n    WHERE   parent_object_id = 6327975429225669221 \n    UNION ALL \n    SELECT  e.[id], \n            e.[code], \n            e.[name], \n            e.[org_id], \n            e.[parent_object_id], \n            e.[is_disbanded], \n            e.[knowledge_parts], \n            e.[tags], \n            e.[experts], \n            e.[place_id], \n            e.[region_id], \n            e.[kpi_profile_id], \n            e.[bonus_profile_id], \n            e.[cost_center_id], \n            e.[is_faculty], \n            e.[modification_date], \n            e.[app_instance_id], \n            e.[kpi_profiles_id], \n            [__hlevel] + 1, \n            cast((d.[__sort_level] + '.' + CAST(FLOOR(LOG10(ROW_NUMBER() over(order by e.id))) as varchar) + cast(ROW_NUMBER() over(order by e.id) as varchar(256))) as varchar(256)) as [__sort_level], \n            (select 1 WHERE EXISTS (SELECT id FROM dbo.subdivisions f WHERE e.id = f.parent_object_id)) as [__hcc] \n    FROM    dbo.subdivisions e \n            INNER JOIN [subdivisions_cte] d ON e.parent_object_id = d.id \n) \n\nselect  t_x.* \nfrom    [subdivisions_cte] t_x \n</code></pre> <pre><code>WITH RECURSIVE \"subdivisions_cte\" ( \n    \"id\", \n    \"code\", \n    \"name\", \n    \"org_id\", \n    \"parent_object_id\", \n    \"is_disbanded\", \n    \"knowledge_parts\", \n    \"tags\",\"experts\", \n    \"place_id\", \n    \"region_id\", \n    \"kpi_profile_id\", \n    \"kpi_profiles_id\", \n    \"bonus_profile_id\", \n    \"cost_center_id\", \n    \"is_faculty\", \n    \"modification_date\", \n    \"app_instance_id\", \n    \"__hlevel\", \n    \"__sort_level\", \n    \"__hcc\" \n) AS ( \n    SELECT  \"id\", \n            \"code\", \n            \"name\", \n            \"org_id\", \n            \"parent_object_id\", \n            \"is_disbanded\", \n            \"knowledge_parts\", \n            \"tags\", \n            \"experts\", \n            \"place_id\", \n            \"region_id\", \n            \"kpi_profile_id\", \n            \"kpi_profiles_id\", \n            \"bonus_profile_id\", \n            \"cost_center_id\", \n            \"is_faculty\", \n            \"modification_date\", \n            \"app_instance_id\", \n            0 as \"__hlevel\", \n            cast((CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n            (select 1 from dbo.subdivisions f where f.parent_object_id = e.id limit 1) as \"__hcc\" \n    FROM    dbo.subdivisions e \n    WHERE   parent_object_id = '6327975429225669221' \n    UNION ALL \n    SELECT  e.\"id\", \n            e.\"code\", \n            e.\"name\", \n            e.\"org_id\", \n            e.\"parent_object_id\", \n            e.\"is_disbanded\", \n            e.\"knowledge_parts\", \n            e.\"tags\", \n            e.\"experts\", \n            e.\"place_id\", \n            e.\"region_id\", \n            e.\"kpi_profile_id\", \n            e.\"kpi_profiles_id\", \n            e.\"bonus_profile_id\", \n            e.\"cost_center_id\", \n            e.\"is_faculty\", \n            e.\"modification_date\", \n            e.\"app_instance_id\", \n            \"__hlevel\"+1, \n            cast((d.\"__sort_level\"||'.'||CAST(FLOOR(LOG(ROW_NUMBER() over(order by e.\"id\"))) as varchar)||cast(ROW_NUMBER() over(order by e.\"id\") as varchar(256))) as varchar(256)) as \"__sort_level\", \n            (select 1 WHERE EXISTS (SELECT id FROM dbo.subdivisions f WHERE e.id = f.parent_object_id)) as \"__hcc\" \n    FROM    dbo.subdivisions e \n            INNER JOIN \"subdivisions_cte\" d ON e.parent_object_id = d.id \n) \n\nselect  t_x.* \nfrom    \"subdivisions_cte\" t_x \n</code></pre>"},{"location":"materials/xquery-to-sql/#isempty","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c IsEmpty()","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $elem in collaborators \nwhere \n    IsEmpty($elem/birth_date) = true() \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <pre><code>for \n    $elem in collaborators \nwhere \n    IsEmpty($elem/birth_date) = true() \nreturn \n    $elem/Fields('id', 'fullname', 'position_name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>SELECT  [t_elem].[id], \n        [t_elem].[fullname], \n        [t_elem].[birth_date] \nFROM    [dbo].[collaborators] [t_elem] \nWHERE   (case when [t_elem].[birth_date] IS NULL then 1 else 0 end) = 1 \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\", \n        t_elem.\"position_name\" \nfrom    dbo.\"collaborators\" t_elem \nwhere   (case when t_elem.\"birth_date\" is null then true else false end)=true \norder by t_elem.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#ljoinon-left-join","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0447\u0435\u0440\u0435\u0437 ljoin/on (LEFT JOIN)","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 <code>XQuery</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043e\u043d\u0438 \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0441\u043e\u0431\u0440\u0430\u043d\u044b \u0432 <code>SQL</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435, <code>ljoin</code> \u0434\u0436\u043e\u0439\u043d\u0438\u0442 \u043f\u0440\u0430\u0432\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 <code>collaborators</code> \u043a \u043b\u0435\u0432\u043e\u0439 <code>positions</code></p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $pos in positions ljoin $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/id, $pos/name \n</code></pre> <pre><code>for \n    $pos in positions ljoin $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/id, $pos/name \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], t_pos.[name] \nfrom    dbo.[collaborators] t_elem \n        LEFT JOIN dbo.[positions] t_pos on t_elem.[position_id] = t_pos.[id] \nwhere   (t_elem.[code] in ('13744', '386792')) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_pos.\"name\" \nfrom    dbo.\"collaborators\" t_elem \n        LEFT JOIN dbo.\"positions\" t_pos on t_elem.\"position_id\"= t_pos.\"id\" \nwhere   (t_elem.\"code\" in ('13744','386792')) \n</code></pre>"},{"location":"materials/xquery-to-sql/#rjoinon-right-join","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0447\u0435\u0440\u0435\u0437 rjoin/on (RIGHT JOIN)","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 <code>XQuery</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043e\u043d\u0438 \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0441\u043e\u0431\u0440\u0430\u043d\u044b \u0432 <code>SQL</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435, <code>rjoin</code> \u0434\u0436\u043e\u0439\u043d\u0438\u0442 \u043f\u0440\u0430\u0432\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 <code>collaborators</code> \u043a \u043b\u0435\u0432\u043e\u0439 <code>positions</code></p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $pos in positions rjoin $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/id, $pos/name \n</code></pre> <pre><code>for \n    $pos in positions rjoin $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/id, $pos/name \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], t_pos.[name] \nfrom    dbo.[collaborators] t_elem \n        RIGHT JOIN dbo.[positions] t_pos on t_elem.[position_id] = t_pos.[id] \nwhere   (t_elem.[code] in (@p0,@p1)) ('13744', '386792')) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_pos.\"name\" \nfrom    dbo.\"collaborators\" t_elem \n        RIGHT JOIN dbo.\"positions\" t_pos on t_elem.\"position_id\"= t_pos.\"id\" \nwhere   (t_elem.\"code\" in ('13744','386792')) \n</code></pre>"},{"location":"materials/xquery-to-sql/#joinon-inner-join","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u043a \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0430\u043c \u0447\u0435\u0440\u0435\u0437 join/on (INNER JOIN)","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 <code>XQuery</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043e\u043d\u0438 \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0441\u043e\u0431\u0440\u0430\u043d\u044b \u0432 <code>SQL</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435, <code>join</code> \u0434\u0436\u043e\u0439\u043d\u0438\u0442 \u043f\u0440\u0430\u0432\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 <code>collaborators</code> \u043a \u043b\u0435\u0432\u043e\u0439 <code>positions</code></p> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code> \u043c\u0435\u0436\u0434\u0443 <code>Fields</code> \u043d\u0435\u0442 \u0437\u0430\u043f\u044f\u0442\u043e\u0439. \u041f\u0440\u0438 \u043f\u043e\u043f\u044b\u0442\u043a\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043f\u044f\u0442\u0443\u044e, \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u044b\u043a\u0438\u0434\u044b\u0432\u0430\u0435\u0442 \u043e\u0448\u0438\u0431\u043a\u0443</p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $pos in positions join $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/Fields('id') $pos/Fields('name') \n</code></pre> <pre><code>for \n    $pos in positions join $elem in collaborators \n        on $elem/position_id = $pos/id \nwhere \n    MatchSome($elem/code, ('13744', '386792')) \nreturn \n    $elem/Fields('id') $pos/Fields('name') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id], t_pos.[name] \nfrom    dbo.[collaborators] t_elem \n        INNER JOIN dbo.[positions] t_pos on t_elem.[position_id] = t_pos.[id] \nwhere   (t_elem.[code] in ('13744', '386792')) \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_pos.\"name\" \nfrom    dbo.\"collaborators\" t_elem \n        INNER JOIN dbo.\"positions\" t_pos on t_elem.\"position_id\"= t_pos.\"id\" \nwhere   (t_elem.\"code\" in ('13744','386792')) \n</code></pre>"},{"location":"materials/xquery-to-sql/#matchsome_1","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0438\u0441\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435\u043c \u0437\u0430\u043f\u0438\u0441\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 MatchSome","text":"<p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446 \u0432 <code>XQuery</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0438 \u0432 \u043a\u0430\u043a\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043e\u043d\u0438 \u043e\u043a\u0430\u0437\u0430\u043b\u0438\u0441\u044c \u0441\u043e\u0431\u0440\u0430\u043d\u044b \u0432 <code>SQL</code> \u0437\u0430\u043f\u0440\u043e\u0441\u0435, <code>ljoin</code> \u0434\u0436\u043e\u0439\u043d\u0438\u0442 \u043f\u0440\u0430\u0432\u0443\u044e \u0442\u0430\u0431\u043b\u0438\u0446\u0443 <code>collaborators</code> \u043a \u043b\u0435\u0432\u043e\u0439 <code>collaborators</code></p> <p>XQuery</p> 649 + MSSQL906 + PostgreSQL <pre><code>for \n    $el in collaborators ljoin $elem in collaborators \n        on $elem/id = $el/id and MatchSome($el/code, ('13744', '386792')) \nwhere \n    $el/id = null() \nreturn \n    $elem/Fields('id') \n</code></pre> <pre><code>for \n    $elem_ex in collaborators ljoin $elem in collaborators \n        on $elem_ex/id = $elem/id and MatchSome($elem_ex/code, ('13744', '386792')) \nwhere \n    $elem_ex/id = null() \nreturn \n    $elem/Fields('id', 'fullname') \n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  t_elem.[id] \nfrom    dbo.[collaborators] t_elem \n    LEFT JOIN dbo.[collaborators] t_el on t_elem.[id]= t_el.[id] and (t_el.[code] in ('13744', '386792')) \nwhere   t_el.[id] IS NULL \n</code></pre> <pre><code>select  t_elem.\"id\", \n        t_elem.\"fullname\" \nfrom    dbo.\"collaborators\" t_elem \n        LEFT JOIN dbo.\"collaborators\" t_elem_ex on t_elem_ex.\"id\"= t_elem.\"id\" and (t_elem_ex.\"code\" in ('13744','386792')) \nwhere   t_elem_ex.\"id\" IS NULL \norder by t_elem_ex.id \n</code></pre>"},{"location":"materials/xquery-to-sql/#distinct","title":"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0441\u043f\u0438\u0441\u043a\u0430 DISTINCT","text":"<p>XQuery</p> 649 + MSSQL906 + PostgreSQL <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0420\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u043a\u043e\u0433\u0434\u0430 \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 <code>XQuery</code> \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u043e \u043f\u043e\u043b\u0435, \u043f\u043e \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u043d\u0443\u0436\u043d\u0430 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c</p> <pre><code>for \n    $elem in group_collaborators \nreturn \n    distinct($elem/group_id) \n</code></pre> <p>\u0412\u0430\u0436\u043d\u043e</p> <p>\u0414\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0439 \u0440\u0430\u0431\u043e\u0442\u044b \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u044f\u0432\u043d\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0443 <code>order by</code> \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 \u0438\u0437 \u0432\u044b\u0432\u043e\u0434\u0438\u043c\u044b\u0445 \u043f\u043e\u043b\u0435\u0439. \u041f\u0440\u043e\u0431\u043b\u0435\u043c\u0430 \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e \u0432 \u0437\u0430\u043f\u0440\u043e\u0441 \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0430 <code>order by t_elem.id</code>, \u043d\u043e \u0432 \u0437\u0430\u043f\u0440\u043e\u0441\u0435 \u0432\u044b\u0432\u043e\u0434\u044f\u0442\u0441\u044f \u0434\u0440\u0443\u0433\u0438\u0435 \u043f\u043e\u043b\u044f, \u0447\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u043e\u0448\u0438\u0431\u043a\u0435.</p> <pre><code>for \n    $elem in learnings \norder by \n    $elem/course_name\nreturn \n    distinct $elem/person_fullname, $elem/course_name\n</code></pre> <p>SQL</p> 649 + MSSQL906 + PostgreSQL <pre><code>select  distinct(t_elem.[group_id]) \nfrom    dbo.[group_collaborators] t_elem \n</code></pre> <pre><code>select  distinct t_elem.\"person_fullname\", \n        t_elem.\"course_name\" \nfrom    dbo.\"learnings\" t_elem \norder by t_elem.\"course_name\" asc nulls first\n</code></pre>"}]}